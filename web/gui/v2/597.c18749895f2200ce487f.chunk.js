!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="fa5372ba-d6a3-42ad-90d2-a8c8ffd634ea",e._sentryDebugIdIdentifier="sentry-dbid-fa5372ba-d6a3-42ad-90d2-a8c8ffd634ea")}catch(e){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"ed021627f8d20b39f0609a37950c1a1e11c33d03"},(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[597],{35539:function(e,t,n){"use strict";n.d(t,{JG:function(){return i},Qj:function(){return m},Ym:function(){return l},Zg:function(){return s},k0:function(){return r},lI:function(){return c},mD:function(){return u},sr:function(){return o},xQ:function(){return a},yu:function(){return d}});const l="silencingRules",r={system:{text:"All users",tooltip:"Rule affects all users"},personal:{text:"Myself",tooltip:"Limit the silencing effect to your account only"}},a="system",o={label:"All rooms",value:""},s={now:{text:"Silence for a specific duration",tooltip:"Rule starts immediately and lasts until the specified duration"},schedule:{text:"Schedule silence",tooltip:"Schedule the rule to start taking effect at some point at the future"}},i="now",c={untilTurnedOff:"Until turned off",oneHour:"1 hour",sixHours:"6 hours",twelveHours:"12 hours",oneDay:"1 day",custom:"Custom"},d={label:"Until turned off",value:"untilTurnedOff"},u={border:{side:"all",color:"inputBorder"},padding:[1,2],margin:[0,0,.5,0],round:!0,justifyContent:"start"},m={ErrInvalidName:"No rule name provided",ErrCodeInvalidStartsAt:"Invalid or no start date provided",ErrCodeInvalidSLastUntil:"Invalid or no end date provided",ErrCodeInvalidScheduleDuration:"Invalid duration selected",ErrCodeInvalidSeverity:"Invalid severity",ErrCodeInvalidIntegration:"Invalid integration",ErrCodeNotOwnRule:"Not permitted to create system rules"}},45396:function(e,t,n){"use strict";n.d(t,{B:function(){return d}});n(57640),n(9924);var l=n(67294),r=n(4480),a=n(74059),o=n(96929),s=n(25819),i=n(93742);const c=()=>{const e=(0,a.th)();return(0,r._8)((t=>{let{set:n,snapshot:l}=t;return async t=>{const r=await l.getPromise((0,o.Nj)({id:t,key:"nodes"}));let a=null;return null!==r&&void 0!==r&&r.length||(n((0,o.Nj)({id:t,key:"loaded"}),!1),a=(0,s.Fz)({roomId:t,spaceId:e}),a.then((e=>{let{data:l}=e;n((0,o.Nj)({id:t,key:"nodes"}),l.map((e=>{let{id:t,name:n}=e;return{label:n,value:t}}))),n((0,o.Nj)({id:t,key:"loaded"}),!0)})).catch((e=>n((0,o.Nj)({id:t,key:"error"}),e)))),a}}),[e])},d=()=>{const e=c(),t=(0,i.p)("id");(0,l.useEffect)((()=>{let n=null;return t&&(n=e(t)),()=>{var e;return!(null===(e=n)||void 0===e||!e.cancel)&&n.cancel()}}),[t,e])};t.Z=c},95384:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ae}});var l=n(67294),r=n(91268),a=n(78266),o=(n(64211),n(2490),n(41874),n(33948),n(46667)),s=n(29814),i=n(72843),c=n(54316),d=n(87462),u=n(22195),m=(n(25387),n(72608),n(15581),n(34514),n(95248)),f=n(8144),g=n(46742),p=(n(57640),n(9924),n(88449),n(59849),n(4480)),y=n(74059),h=n(25403),b=n(93742);const v=e=>(t,n)=>{const l=t[e];return!Array.isArray(n)||!n.length||(Array.isArray(l)?n.some((e=>l.includes(e))):n.includes(l))},E={roomIds:v("roomIds"),nodeIds:v("nodeIds"),hostLabels:(x="hostLabels",(e,t)=>{const n=e[x];if(!n)return!t.length;const l=Object.entries(n).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}));return v(x)({...e,[x]:l},t)}),alertNames:v("alertNames"),alertRoles:v("alertRoles"),alertContexts:v("alertContexts")};var x;const k=(0,p.CG)({key:"silencingRulesFiltered",get:e=>{let{extraKey:t,spaceId:n,omit:l=[],keepAll:r,allNodesRoomId:a}=e;return e=>{let{get:o}=e;const s=o((0,m.dz)({key:n,extraKey:t})),i=Object.keys(s).reduce(((e,t)=>(l.includes(t)||e.push([t,s[t]]),e)),[]),c=o((0,h.z5)({id:n,allNodesRoomId:a}));if(!i.length)return c;const d=(e=>t=>!e.some((e=>{let[n,l]=e;return!!E[n]&&!E[n](t,l)})))(i),{rules:u,...f}=c;return r?c:{...f,rules:u.filter(d)}}}}),I=function(){let{extraKey:e,omit:t=[],keepAll:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const l=(0,y.th)(),r=(0,b.p)("id");return(0,p.sJ)(k({extraKey:e,spaceId:l,omit:t,keepAll:n,allNodesRoomId:r}))};var w=n(62447);const A=(e,t,n)=>{let{id:l,name:r}=e;-1==n?t.push({id:l,name:r,count:1}):t[n]={...t[n],count:t[n].count+1}},C=e=>e.id,K=e=>e.name;var S=e=>{let{title:t,baseKey:n,param:r,paramKey:a,extraKey:o,testIdPrefix:s}=e;const i=(e=>{let{baseKey:t,extraKey:n,param:r,paramKey:a}=e;const{rules:o}=I({extraKey:n,omit:[r],keepAll:!0}),s=(0,m.by)(r,{key:t,extraKey:n});return(0,l.useMemo)((()=>o.reduce(((e,t)=>{const n=t[a];if(!n)return e;const l=e.findIndex((e=>e.id==n.id));return["rooms","nodes"].includes(a)?n.forEach((t=>{let{id:n,name:r,notAvailable:a}=t;const o=a?"Not available (".concat(n,")"):r;A({id:n,name:o},e,l)})):["alertNames","alertContexts","alertRoles"].includes(a)?n.forEach((t=>{A({id:t,name:t},e,l)})):"hostLabels"==a&&Object.entries(n).forEach((t=>{let[n,r]=t;const a=(0,w.q)({key:n,value:r});A({id:a,name:a},e,l)})),e}),[])),[o,s])})({baseKey:n,extraKey:o,param:r,paramKey:a});return i.length?l.createElement(f.Z,{title:t,testIdPrefix:s,param:r,baseKey:n,extraKey:o},l.createElement(g.ZP,{param:r,baseKey:n,extraKey:o,testIdPrefix:s,collection:i,getValue:C,getLabel:K,capitalized:!1})):null},R=n(35539);const N=[{title:"Rooms",param:"roomIds",paramKey:"rooms"},{title:"Nodes",param:"nodeIds",paramKey:"nodes"},{title:"Host labels",param:"hostLabels",paramKey:"hostLabels"},{title:"Alert names",param:"alertNames",paramKey:"alertNames"},{title:"Alert contexts",param:"alertContexts",paramKey:"alertContexts"},{title:"Alert roles",param:"alertRoles",paramKey:"alertRoles"}],Z=(0,l.memo)((e=>{const t=(0,y.th)();return l.createElement(u.Flex,(0,d.Z)({column:!0,height:"calc(100vh - 266px)",overflow:{vertical:"auto"},padding:[0,0,30]},e),N.map((e=>{let{title:n,param:r,paramKey:a}=e;return l.createElement(S,{key:n,baseKey:t,extraKey:R.Ym,title:n,param:r,paramKey:a})})))}));const T={filters:{iconName:"filterList",color:{active:"success",notActive:"textLite"},width:"19px",Content:Z,dataTestId:"filterBar",label:"Filters"}},L=["filters"],j=e=>e.some((e=>{let{roomIds:t=[],nodeIds:n=[],hostLabels:l={},alertNames:r=[],alertContexts:a=[],alertRoles:o=[]}=e;return t.length||n.length||Object.keys(l).length||r.length||a.length||o.length}));var D=e=>{let{rules:t}=e;const[n,r]=(0,o.Z)((()=>j(t))),{Content:a}=T.filters;return(0,l.useEffect)((()=>{r(j(t))}),[t]),l.createElement(c.ZP,{collapsedComponent:l.createElement(s.Z,{onClickTab:r,availableTabs:T,tabsToShow:L}),isOpen:n,header:l.createElement(i.Z,{isOpen:n,onToggle:r,title:"Filters",icon:"filterList"})},l.createElement(a,{padding:[0,3,30]}))},F=n(2145),O=n(91008),_=n(41331),P=(n(17727),n(89405)),M=n(93017),z=n(82351);const B=e=>{let{value:t,...n}=e;return l.createElement(z.Z,{content:t},l.createElement(u.Pill,(0,d.Z)({maxWidth:"100%",overflow:"hidden",flavour:"neutral",color:"neutralPillColor",size:"small",justifyContent:"start",margin:[1]},n),t))},G=()=>l.createElement(u.Text,null,"*"),H=e=>{let{getValue:t}=e;const n=t();return null!==n&&void 0!==n&&n.length?l.createElement(u.Flex,{flexWrap:!0},n.map((e=>l.createElement(B,{key:e,value:e})))):l.createElement(G,null)},V=e=>{let{getValue:t}=e;const{localeDateString:n}=(0,P.rA)();if(!t())return l.createElement(u.Text,null,"-");const r=n(new Date(t()),{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",long:!1,dateStyle:void 0});return l.createElement(u.Text,{whiteSpace:"nowrap"},r)},U=[{id:"disabled",name:"Disable rule",accessorKey:"disabled",header:"",cell:e=>{let{row:t,getValue:n}=e;const r=t.original,[a,s]=(0,l.useState)(!n()),[i,c]=(0,o.Z)(),[,d]=(0,M.Z)(),m=(0,h.j6)(),f=(0,h._A)();return l.createElement(u.Toggle,{colored:!0,checked:a,disabled:i,onChange:e=>{c();const t=e.target.checked;s(t),m({...r,disabled:!t}).then((()=>{f()})).catch((e=>{s(!t),d(e)})).finally(c)}})},size:50,maxSize:50,minSize:50},{id:"name",name:"Name",accessorKey:"name",header:"Rule name",cell:e=>{let{row:t,getValue:n}=e;const{accountId:r}=t.original;return l.createElement(u.Flex,{gap:2,alignItems:"center"},l.createElement(u.Text,{wordBreak:"break-word"},n()),r&&l.createElement(z.Z,{align:"bottom",content:"This rule affects only your account"},l.createElement(u.Icon,{color:"textLite",height:"16px",name:"userPress",width:"16px"})))}},{id:"rooms",name:"Rooms",accessorKey:"rooms",header:"Rooms",cell:e=>{let{getValue:t}=e;const n=t();return null!==n&&void 0!==n&&n.length?l.createElement(u.Text,null,n.map((e=>{let{name:t}=e;return t})).join(", ")):l.createElement(u.Text,null,"All rooms")}},{id:"nodes",name:"Nodes",accessorKey:"nodes",header:"Nodes",cell:e=>{let{getValue:t}=e;const n=t();return null!==n&&void 0!==n&&n.length?l.createElement(u.Flex,{flexWrap:!0},n.map((e=>{let{id:t,name:n,notAvailable:r}=e;const a=r?l.createElement(u.Flex,{alignItems:"center",gap:1},l.createElement(u.Icon,{name:"warning_triangle",size:"small",color:"neutralPillColor"}),l.createElement(u.Text,null,"Node no longer available")):n;return l.createElement(B,{key:t,value:a})}))):l.createElement(G,null)}},{id:"hostLabels",name:"Host labels",accessorKey:"hostLabels",header:"Host labels",cell:e=>{let{getValue:t}=e;const n=t(),r=Object.entries(n||{});return r.length?l.createElement(u.Flex,{flexWrap:!0},r.map((e=>{let[t,n]=e;const r=(0,w.q)({key:t,value:n});return l.createElement(B,{key:r,value:r})}))):l.createElement(G,null)}},{id:"alertNames",name:"Alert names",accessorKey:"alertNames",header:"Alert name",cell:H},{id:"alertContexts",name:"Alert contexts",accessorKey:"alertContexts",header:"Alert context",cell:H},{id:"alertRoles",name:"Alert roles",accessorKey:"alertRoles",header:"Alert role",cell:H},{id:"startDate",name:"Start date",accessorKey:"startsAt",header:"Start date",cell:V,size:120},{id:"endDate",name:"End date",accessorKey:"lastsUntil",header:"End date",cell:V,size:120}];n(92686);var J=n(33335);const Y={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",long:!1,dateStyle:void 0};const Q=(0,F.Z)((()=>n.e(20).then(n.bind(n,9020))),"CreateOrUpdateRuleModal"),W=(0,l.memo)(u.NetdataTable,((e,t)=>(0,_.ZP)(e,t))),q={right:["actions"]},X=()=>l.createElement(u.Flex,null,l.createElement(u.Text,null,"Create or Maintain Alert Notification Silencing Rules on this Space. These rules can be applicable to all users or just you, depending on their definition."," ",l.createElement(O.Z,{"data-ga":"alert-silencing::click-link-docs::rules-table","data-testid":"silencing-rules-doc",href:"https://learn.netdata.cloud/docs/alerts-and-notifications/notifications/netdata-cloud-notifications/#silencing-alert-notifications",rel:"noopener noreferrer",target:"_blank"},"Read the Alert Notification Silencing Rules documentation to learn more.")));var $=e=>{let{data:t}=e;const{search:n,setSearch:r,bulkActions:a,rowActions:o,onFilter:s,modalDetails:i,closeModal:c}=(()=>{const[e,t]=(0,l.useState)(""),[n,r]=(0,l.useState)({}),[,a]=(0,M.Z)(),{localeDateString:o}=(0,P.rA)(),s=(0,h.hr)(),i=(0,h._A)(),c=()=>r({type:"create"}),d=e=>r({type:"edit",rule:e}),m=e=>{let{id:t}=e;s([t]).then((()=>{i()})).catch(a)},f=(0,J.gI)("space:DeletePersonalSilencingRule"),g=(0,J.gI)("space:DeleteSystemSilencingRule"),p=(0,l.useMemo)((()=>({addEntry:{dataGa:"",flavour:"hollow",handleAction:c,iconColor:"success",label:"Add rule",small:!0,width:"auto"}})),[]),y=e=>{let{name:t}=e;return l.createElement(l.Fragment,null,"Delete ",l.createElement(u.H3,{wordBreak:"break-word"},t)," rule")};return{search:e,setSearch:t,bulkActions:p,rowActions:(0,l.useMemo)((()=>({edit:{handleAction:d,disabledTooltipText:"Edit is disabled",isDisabled:e=>{let{readOnly:t}=e;return!!t},dataGa:"alert-silencing::click-edit-row::rules-table"},delete:{handleAction:m,confirmationTitle:y,confirmationMessage:e=>l.createElement(u.Text,{wordBreak:"break-word"},"You are about to delete ",l.createElement("strong",null,e.name)," silencing rule.",l.createElement("br",null),"Are you sure you want to continue?"),dataGa:"alert-silencing::click-delete-row::rules-table",disabledTooltipText:"Delete is disabled",confirmLabel:"Yes, delete",declineLabel:"Cancel",isDisabled:e=>{let{accountId:t}=e;return t?!f:!g}}})),[]),onFilter:(0,l.useCallback)(((e,t,n)=>{const l=e.original,r=n.toLowerCase(),a=(l.rooms||[]).map((e=>{let{name:t}=e;return t})),s=(l.nodes||[]).map((e=>{let{name:t}=e;return t})),i=l.alertNames||[],c=l.alertContexts||[],d=l.alertRoles||[],u=l.hostLabels||{},m=l.startsAt?o(new Date(l.startsAt),Y):"",f=l.lastsUntil?o(new Date(l.lastsUntil),Y):"";return((e,t)=>e.some((e=>e.toLowerCase().includes(t))))([l.name.toLowerCase(),...a,...s,...i,...c,...d,...Object.entries(u).flat(),m,f],r)}),[]),modalDetails:n,closeModal:()=>r({})}})();return l.createElement(l.Fragment,null,l.createElement(u.Flex,{column:!0,gap:4,padding:[2,4],height:"calc(100vh - 241px)"},l.createElement(X,null),l.createElement(W,{key:JSON.stringify(t||{}),enableSorting:!0,enableColumnVisibility:!0,data:t,dataColumns:U,bulkActions:a,rowActions:o,globalFilter:n,globalFilterFn:s,onGlobalSearchChange:r,columnPinning:q,enableColumnPinning:!0,enablePinning:!0})),"create"==i.type&&l.createElement(l.Suspense,null,l.createElement(Q,{onClose:c})),"edit"==i.type&&i.rule&&l.createElement(l.Suspense,null,l.createElement(Q,{rule:i.rule,onClose:c,isEdit:!0})))},ee=n(94050),te=n(73787),ne=n(5429);var le=e=>{let{errorMessage:t}=e;return l.createElement(u.Flex,{column:!0,gap:2,alignItems:"center",justifyContent:"center",flex:!0},l.createElement(u.TextBig,null,"Something went wrong"),t&&l.createElement(u.Text,null,"(",t,")"))},re=n(45396),ae=()=>{(e=>{const t=(0,h.oO)({id:e,key:"initialLoad"}),n=(0,h.tZ)(),l=(0,h.XJ)(e);(0,ne.Z)((()=>({enabled:!!e&&!t,fetch:()=>(0,ee.KH)(e),onFail:e=>l({...te.R,loading:!1,loaded:!0,error:e}),onSuccess:e=>l(((e,t)=>({...e,loading:!1,loaded:!0,initialLoad:!0,rules:t}))(te.R,e))})),[e,n])})((0,y.th)()),(0,re.B)();const{loaded:e,rules:t,error:n}=I({extraKey:R.Ym});return e?n?l.createElement(le,{errorMessage:n.message}):l.createElement(r.Z,{rightBar:l.createElement(D,{rules:t}),margin:[3,0]},l.createElement($,{data:t})):l.createElement(a.Z,{height:"calc(100% - 44px)",title:"Loading silencing rules..."})}},62447:function(e,t,n){"use strict";n.d(t,{_:function(){return r},q:function(){return a}});n(25387),n(2490),n(72608),n(33948);var l=n(35539);const r=e=>{var t;const{validationErrors:n,errorMessage:r}=(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)||{};return n&&Object.keys(n).length?Object.entries(n).reduce(((e,t)=>{let[,n]=t;const{Code:r}=n;return l.Qj[r]&&e.push({errorMessage:l.Qj[r]}),e}),[]):[{errorMessage:r}]},a=e=>{let{key:t,value:n}=e;return"".concat(t,": ").concat(n)}},94050:function(e,t,n){"use strict";n.d(t,{KF:function(){return c},KH:function(){return o},nt:function(){return s},oG:function(){return i}});n(57640),n(9924);var l=n(26398),r=n(66152);const a=e=>e.map((e=>(0,r.k5)(e))),o=e=>l.Z.get("/api/v2/spaces/".concat(e,"/notifications/silencing/rules"),{transform:a}),s=(e,t)=>l.Z.post("/api/v2/spaces/".concat(e,"/notifications/silencing/rules/delete"),t),i=(e,t)=>l.Z.post("/api/v2/spaces/".concat(e,"/notifications/silencing/rule"),(0,r.v)(t)),c=(e,t)=>l.Z.put("/api/v2/spaces/".concat(e,"/notifications/silencing/rule/").concat(t.id),(0,r.v)(t))},25403:function(e,t,n){"use strict";n.d(t,{XJ:function(){return m},_A:function(){return p},hr:function(){return b},j6:function(){return h},oO:function(){return u},tZ:function(){return g},wK:function(){return y},z5:function(){return d}});n(57640),n(9924),n(31672),n(2490),n(59461);var l=n(4480),r=n(74059),a=n(37518),o=n(94050),s=n(73787),i=n(96929),c=n(93742);const d=(0,l.CG)({key:"silencingRulesState",get:e=>{let{id:t,key:n,allNodesRoomId:l}=e;return e=>{let{get:r}=e;const a=r((0,s.Z)(t)),{rules:o,...c}=a,d=r((0,i.Nj)({id:l,key:"nodes"})),u={...c,rules:o.map((e=>({...e,...e.nodeIds?{nodes:e.nodeIds.map((e=>{const t=d.find((t=>t.value==e));return{id:e,name:(null===t||void 0===t?void 0:t.label)||"-",notAvailable:!t}}))}:{}})))};return n?u[n]:u}},set:e=>{let{id:t,key:n}=e;return(e,l)=>{let{get:r,set:o}=e;const{rules:i}=l;o((0,s.Z)(t),(e=>{if(i){const e=i.map((e=>{let{roomIds:t,nodeIds:n,...l}=e;const o=t?t.map((e=>{const{id:t,name:n}=r((0,a.n2)({id:e}));return{id:t,name:n}})):void 0;return{...l,...t?{roomIds:t}:{},...o?{rooms:o}:{},...n?{nodeIds:n}:{}}}));l.rules=e}return n?{...e,[n]:l}:{...e,...l}}))}}}),u=e=>{let{id:t,key:n}=e;const r=(0,c.p)("id");return(0,l.sJ)(d({id:t,key:n,allNodesRoomId:r}))},m=(e,t)=>(0,l.Zl)(d({id:e,key:t})),f=(0,l.cn)({key:"forceUpdateRulesSelector",default:0}),g=()=>(0,l.sJ)(f),p=()=>{const e=(0,r.th)(),t=m(e),n=(0,l.Zl)(f);return()=>{t((e=>({...e,initialLoad:!1}))),n((e=>e+1))}},y=()=>{const e=(0,r.th)();return t=>(0,o.oG)(e,t)},h=()=>{const e=(0,r.th)();return t=>(0,o.KF)(e,t)},b=()=>{const e=(0,r.th)();return t=>(0,o.nt)(e,t)}},73787:function(e,t,n){"use strict";n.d(t,{R:function(){return r}});var l=n(4480);const r={rules:[],error:"",id:null,loading:!0,loaded:!1,initialLoad:!1};t.Z=(0,l.xu)({key:"silencingRulesState",default:e=>(e=>({...r,id:e}))(e)})},92686:function(e,t,n){n(51223)("flat")}}]);