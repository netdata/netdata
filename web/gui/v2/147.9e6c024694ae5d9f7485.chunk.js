!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0831e718-4f98-47a6-8bf2-97f93b168727",e._sentryDebugIdIdentifier="sentry-dbid-0831e718-4f98-47a6-8bf2-97f93b168727")}catch(e){}}(),(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[147],{65147:(e,t,n)=>{n.r(t),n.d(t,{default:()=>pe});var a=n(67294),o=n(54851),l=n(87053),r=n(65528),s=n(29439),i=n(4942),c=n(45987),u=n(50308),d=n.n(u),m=n(22464),p=n(63150),f=["scope","setScope","isDisabled"];function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const g=function(e){var t=e.scope,n=e.setScope,l=void 0===n?d():n,r=e.isDisabled,u=(0,c.Z)(e,f);return a.createElement(o.Flex,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({gap:3},u),Object.entries(p.k0).map((function(e){var n=(0,s.Z)(e,2),i=n[0],c=n[1],u=c.text,d=c.tooltip;return a.createElement(o.RadioButton,{key:i,checked:i===t,onChange:function(){return l(i)},disabled:r},a.createElement(m.Z,{content:d,align:"bottom"},a.createElement(o.TextSmall,{color:"textDescription"},u)))})))};var v=n(42339),h=n(15267);const E=function(e){var t=e.selectedKey,n=e.selectedValue,l=e.onAddHostLabel,r=void 0===l?d():l,c=e.onRemoveHostLabel,u=void 0===c?d():c,p=e.isDefault,f=void 0!==p&&p,b=e.showPlaceholder,g=void 0===b?d():b,h=e.isDisabled,E=(0,a.useState)(t||""),O=(0,s.Z)(E,2),y=O[0],D=O[1],C=(0,a.useState)(n||""),Z=(0,s.Z)(C,2),x=Z[0],S=Z[1],k=function(){y&&x&&(r((0,i.Z)({},y,x)),g())};return a.createElement(o.Flex,{gap:2},a.createElement(v.Z,{component:"input",onChange:D,onBlur:k,placeholder:"Host key",value:y,disabled:h||!f}),a.createElement(v.Z,{component:"input",onChange:S,onBlur:k,placeholder:"Host value",value:x,disabled:h||!f||!y}),f?a.createElement(m.Z,{content:"Save label pair",align:"bottom"},a.createElement(o.Button,{flavour:"borderless",disabled:!y||!x},a.createElement(o.Icon,{name:"check",color:"primary",size:"small"}))):a.createElement(m.Z,{content:"Remove label pair",align:"bottom"},a.createElement(o.Button,{flavour:"borderless",onClick:function(){return u(t)}},a.createElement(o.Icon,{name:"x",color:"primary",size:"small"}))))};var O=function(e){var t=e.hostLabels,n=e.onAddHostLabel,o=e.onRemoveHostLabel;return Object.entries(t).map((function(e){var t=(0,s.Z)(e,2),l=t[0],r=t[1];return a.createElement(E,{key:l,onAddHostLabel:n,selectedKey:l,selectedValue:r,onRemoveHostLabel:o})}))};const y=function(e){var t=e.hostLabels,n=e.onAddHostLabel,l=void 0===n?d():n,r=e.onRemoveHostLabel,i=void 0===r?d():r,c=e.isEdit,u=e.isDisabled,m=!!Object.entries(t||{}).length,p=(0,h.Z)(!1),f=(0,s.Z)(p,3),b=f[0],g=f[2];return a.createElement(o.Flex,{column:!0,gap:1},a.createElement(o.TextSmall,{color:"textLite"},"Host labels"),m&&a.createElement(O,{hostLabels:t,onAddHostLabel:l,onRemoveHostLabel:i}),(!m||b)&&a.createElement(E,{key:JSON.stringify(t),onAddHostLabel:l,isDefault:!0,showPlaceholder:g,isDisabled:u}),c&&!b&&m&&a.createElement(o.Flex,{justifyContent:"end"},a.createElement(o.Button,{flavour:"borderless",onClick:g},"Add host label")))};var D=n(92567);function C(){var e=new Date,t=e.getFullYear(),n=e.getMonth(),a=e.getDate(),o=new Date(0);return o.setFullYear(t,n,a+1),o.setHours(0,0,0,0),o}var Z=n(69119),x=n(29422),S=n(6264),k=Object.entries(p.lI).map((function(e){var t=(0,s.Z)(e,2),n=t[0];return{label:t[1],value:n}})),w=C(),j=(0,Z.Z)((0,x.Z)(w,{years:1}));const P=function(e){var t=e.duration,n=e.setDuration,l=e.setDate,r=e.endDate,s=e.isDisabled,i=(0,S.by)("offset");return a.createElement(o.Flex,{gap:2},a.createElement(v.Z,{component:"select",title:"Duration",onChange:n,options:k,placeholder:"Select duration",value:t,isDisabled:s}),"custom"===t.value&&a.createElement(o.Flex,{alignSelf:"end"},a.createElement(D.Z,{isSinglePicker:!0,values:{singleDate:r},minDate:w,maxDate:j,utc:i,onChange:l,isPlaying:!1,accessorProps:p.mD,padding:[4,0],width:"auto",accessorTooltipContent:"Select end date"})))};function L(){return(0,Z.Z)(Date.now())}var A=L(),R=C();const H=function(e){var t=e.start,n=e.end,l=e.onChange,r=e.isDisabled,i=e.isEdit,c=(0,a.useState)(i?"schedule":p.JG),u=(0,s.Z)(c,2),d=u[0],f=u[1],b=(0,a.useState)(p.yu),g=(0,s.Z)(b,2),v=g[0],h=g[1],E=(0,a.useState)(0),O=(0,s.Z)(E,2),y=O[0],k=O[1],w=(0,S.by)("offset"),j=(0,a.useState)(t?new Date(t):i?null:A),H=(0,s.Z)(j,2),I=H[0],F=H[1],_=(0,a.useState)(n?new Date(n):i?null:R),B=(0,s.Z)(_,2),N=B[0],U=B[1],M=(0,a.useState)((0,Z.Z)((0,x.Z)(I,{days:1}))),T=(0,s.Z)(M,2),z=T[0],G=T[1];(0,a.useEffect)((function(){var e=(0,x.Z)(I,{days:1});G(e),!i&&I>=N&&U(e)}),[I]),(0,a.useEffect)((function(){l({start:I,end:N,scheduleOption:d,duration:v})}),[I,N,d,v]);var K=C(),V=(0,Z.Z)((0,x.Z)(K,{years:1}));return a.createElement(o.Flex,{column:!0,gap:3},!i&&a.createElement(o.Flex,{gap:3},Object.entries(p.Zg).map((function(e){var t=(0,s.Z)(e,2),n=t[0],l=t[1],i=l.text,c=l.tooltip;return a.createElement(o.RadioButton,{key:n,checked:n===d,onChange:function(){return f(n)},disabled:r},a.createElement(m.Z,{content:c,align:"bottom"},a.createElement(o.TextSmall,{color:"textDescription"},i)))}))),"now"===d?a.createElement(P,{duration:v,setDuration:h,setDate:function(e){F(Date.now()),U(e)},endDate:N,isDisabled:r}):a.createElement(o.Flex,{gap:2},a.createElement(o.Flex,{column:!0,gap:2,flex:{grow:1,shrink:1},basis:0},a.createElement(o.TextSmall,null,"Start date"),a.createElement(D.Z,{isSinglePicker:!0,values:{singleDate:new Date(I)},minDate:L(),maxDate:V,utc:w,onChange:function(e){F(e),k((function(e){return e+1}))},isPlaying:!1,accessorProps:p.mD,padding:[4,0],width:"auto",accessorTooltipContent:"Select start date"})),a.createElement(o.Flex,{column:!0,gap:2,flex:{grow:1,shrink:1},basis:0},a.createElement(o.TextSmall,null,"End date"),a.createElement(D.Z,{key:y,isSinglePicker:!0,values:{singleDate:N?new Date(N):N},minDate:z,maxDate:V,utc:w,onChange:U,isPlaying:!1,accessorProps:p.mD,padding:[4,0],width:"auto",accessorTooltipContent:"Select end date"}))))},I=function(e){var t=e.content,n=void 0===t?"Loading alerts...":t;return a.createElement(o.Flex,{height:45,alignItems:"center",justifyContent:"center"},a.createElement(o.Text,null,n))};var F=n(26380);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const B=function(e){return a.createElement(o.Flex,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({gap:2,alignItems:"center"},e),a.createElement(o.Icon,{size:"small",color:"warning",name:"warning_triangle"}),a.createElement(o.Text,null,"This feature is only available to paid plans"),a.createElement(F.Z,{classification:"Pro",content:"Go to Pro plan"}),a.createElement(F.Z,{classification:"Business",content:"Go to Business plan"}))};var N=n(89250),U=n(2086),M=n(28969),T=n(26503),z=n(38700),G=n(25464),K=n(38141),V=n(62594),Q=n(8534),J=n(4480),W=n(60429),Y=(0,J.CG)({key:"spaceAlertMetas",get:function(e){return function(){return(0,W.uk)(e)}}}),$=n(29620),q=n(89960),X=n(88715),ee=["id","name"],te=["rooms","nodes","hostLabels","startsAt","lastsUntil"],ne=["accountId","scope","rooms","nodes","hostLabels","startsAt","lastsUntil","scheduleOption","duration"];function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le={name:"",rooms:[],nodes:[],hostLabels:null,alertNames:[],alertContexts:[],alertRoles:[],startsAt:null,lastsUntil:null},re=function(e){var t=e.id;return oe({label:e.name,value:t},(0,c.Z)(e,ee))},se=function(e){return{label:e,value:e}},ie=function(e){return e.value},ce=function(e,t){e.accountId;var n=e.scope,a=e.rooms,o=e.nodes,l=e.hostLabels,r=e.startsAt,s=e.lastsUntil,i=e.scheduleOption,u=e.duration,d=(0,c.Z)(e,ne),m=a.filter((function(e){return e.value!==p.sr.value})).map(ie),f=o.map(ie),b=!!Object.keys(l||{}).length,g=function(e){var t=e.startsAt,n=e.lastsUntil,a=e.scheduleOption,o=e.duration;if("schedule"==a)return{start:t,end:n};var l=Date.now(),r=void 0;switch(o){case"oneHour":r=(0,x.Z)(l,{hours:1});break;case"sixHours":r=(0,x.Z)(l,{hours:6});break;case"twelveHours":r=(0,x.Z)(l,{hours:12});break;case"oneDay":r=(0,x.Z)(l,{days:1});break;case"custom":r=n}return oe({start:l},r?{end:r}:{})}({startsAt:r,lastsUntil:s,scheduleOption:i,duration:u}),v=g.start,h=g.end;return oe(oe(oe(oe(oe(oe(oe({},d),"personal"==n?{account_id:t}:{}),m.length?{room_ids:m}:{}),f.length?{node_ids:f}:{}),b?{host_labels:l}:{}),v?{starts_at:new Date(v).toISOString()}:{}),h?{lasts_until:new Date(h).toISOString()}:{})};const ue=function(e){var t,n=e.rule,o=e.onClose,l=e.isEdit,r=(0,U.jr)(),u=(0,N.s0)(),d=(0,z.uk)(),m=(0,h.Z)(),f=(0,s.Z)(m,2),b=f[0],g=f[1],v=(0,V.Z)({all:!0}),E=null===(t=v.find((function(e){return"All nodes"==e.label})))||void 0===t?void 0:t.value,O=function(){var e,t=(0,z.th)(),n=(0,J.$P)(Y(t));return{loaded:"loading"!==n.state,value:(null===(e=n.contents)||void 0===e?void 0:e.data)||W.ND,hasError:"hasError"===n.state}}(),y=O.loaded,D=O.value,C=O.hasError,Z=(0,Q.wK)(),x=(0,Q.j6)(),S=l?x:Z,k=(0,Q._A)(),w=(0,X.Z)(),j=(0,s.Z)(w,3)[2],P=(0,a.useState)({alertNameOptions:[],alertContextOptions:[],alertRoleOptions:[]}),L=(0,s.Z)(P,2),A=L[0],R=L[1],H=A.alertNameOptions,I=A.alertContextOptions,F=A.alertRoleOptions,_=(0,a.useState)((function(){return oe(oe({},le),function(e){var t,n=e.rooms,a=e.nodes,o=e.hostLabels,l=e.startsAt,r=e.lastsUntil,s=(0,c.Z)(e,te);return oe(oe(oe(oe(oe({},s),{},{scope:s.accountId?"personal":p.xQ,canSubmit:!!(null===(t=null===s||void 0===s?void 0:s.name)||void 0===t?void 0:t.length),rooms:(null===n||void 0===n?void 0:n.length)?n.map(re):[K.k_]},(null===a||void 0===a?void 0:a.length)?{nodes:a.map(re).filter((function(e){return!e.notAvailable}))}:{}),o?{hostLabels:o}:{}),l?{startsAt:l}:{}),r?{lastsUntil:r}:{})}(n))})),B=(0,s.Z)(_,2),ee=B[0],ne=B[1],ae=(0,G.IW)(ee.roomIds||[E]),ie=(0,a.useCallback)((function(e){return ne((function(t){return oe(oe({},t),{},{scope:e})}))}),[]),ue=(0,a.useCallback)((function(e){return ne((function(t){return oe(oe({},t),{},{name:e,canSubmit:!!(null===e||void 0===e?void 0:e.length)})}))}),[]),de=(0,a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=function(e){return e.length<=1?e:e[e.length-1].value==p.sr.value?[p.sr]:e.filter((function(e){return!!e.value}))}(e),a=n.map((function(e){return e.value||E})),o=t.length<n.length?n.filter((function(e){var n=e.value;return!t.includes(n)}))[0]:null;ne((function(e){return oe(oe({},e),{},{rooms:n,roomIds:a,lastRoomAdded:o||null})}))}),[E]),me=(0,a.useCallback)((function(e){return ne((function(t){return oe(oe({},t),{},{nodeIds:e.map((function(e){return e.value})),nodes:e})}))}),[]),pe=(0,a.useCallback)((function(e){return ne((function(t){return oe(oe({},t),{},{hostLabels:oe(oe({},t.hostLabels),e)})}))}),[]),fe=(0,a.useCallback)((function(e){return ne((function(t){var n=oe({},t.hostLabels);return delete n[e],oe(oe({},t),{},{hostLabels:n})}))}),[]),be=(0,a.useCallback)((function(e){return function(t){return ne((function(n){return oe(oe({},n),{},(0,i.Z)({},e,t.map((function(e){return e.value}))))}))}}),[]),ge=(0,a.useCallback)((function(e){var t=e.start,n=e.end,a=e.scheduleOption,o=e.duration;return ne((function(e){return oe(oe({},e),{},{startsAt:t,lastsUntil:n,scheduleOption:a,duration:o.value})}))}),[]),ve=(0,a.useCallback)((function(){g(),S(ce(ee,r)).then((function(){o(),k()})).catch((function(e){return j((0,$._)(e))})).finally(g)}),[ee,r]),he=(0,q.Z)();(0,a.useEffect)((function(){var e,t=(null===(e=ee.lastRoomAdded)||void 0===e?void 0:e.value)||E,n=null;return t&&(n=he(t)),function(){return!!(null===n||void 0===n?void 0:n.cancel)&&n.cancel()}}),[ee.roomIds,he]),(0,a.useEffect)((function(){if(y){var e=D||{},t=e.contexts,n=e.names,a=e.roles;R({alertNameOptions:n?n.map(se):[],alertContextOptions:t?t.map(se):[],alertRoleOptions:a?a.map(se):[]})}}),[y]);var Ee=(0,M.gI)(T.mk.spaceCreatePersonalSilencingRule),Oe=(0,a.useCallback)((function(){return u("/spaces/".concat(d,"/settings/billing"))}),[d]);return{state:ee,onScopeChange:ie,onRuleNameChange:ue,onRoomsSelectionChange:de,roomOptions:v,onNodesSelectionChange:me,nodesOptions:ae,alertMetasLoaded:y,alertMetas:D,alertNameOptions:H,alertContextOptions:I,alertRoleOptions:F,alertMetasError:C,onAlertValueChange:be,onAddHostLabel:pe,onRemoveHostLabel:fe,onDatesChange:ge,loading:b,onSave:ve,spaceCreatePersonalSilencingRule:Ee,onUpdateButtonClick:Oe}};var de=function(e){return(null===e||void 0===e?void 0:e.length)?e.map(se):[]},me=function(){return a.createElement(o.Box,{as:"hr",height:"1px",width:"100%",sx:{borderWidth:"1px 0px 0px 0px",borderColor:"borderSecondary",borderStyle:"solid"}})};const pe=function(e){var t=e.rule,n=void 0===t?{}:t,s=e.onClose,i=e.isEdit,c=ue({rule:n,onClose:s,isEdit:i}),u=c.state,d=c.onScopeChange,p=c.onRuleNameChange,f=c.onRoomsSelectionChange,b=c.roomOptions,h=c.onNodesSelectionChange,E=c.nodesOptions,O=c.alertMetasLoaded,D=c.alertNameOptions,C=c.alertContextOptions,Z=c.alertRoleOptions,x=c.onAlertValueChange,S=c.onAddHostLabel,k=c.onRemoveHostLabel,w=c.onDatesChange,j=c.loading,P=c.onSave,L=c.spaceCreatePersonalSilencingRule,A=c.onUpdateButtonClick;return a.createElement(o.Modal,{onEsc:s},a.createElement(r.hz,{style:{maxHeight:"800px"}},a.createElement(o.ModalHeader,{padding:[6,4,3]},a.createElement(o.Flex,{column:!0,gap:2},a.createElement(o.Flex,{flex:!0,alignItems:"center",justifyContent:"between"},a.createElement(o.H4,null,"Add silencing rule"),s&&a.createElement(r.A3,{onClose:s})),a.createElement(o.Text,null,"Define an alert notification silencing rule that will apply to all users or just you."," ",a.createElement(l.Z,{"data-ga":"alert-silencing::click-link-docs::rule-modal","data-testid":"silencing-rules-doc",href:"https://learn.netdata.cloud/docs/alerts-and-notifications/notifications/netdata-cloud-notifications/manage-alert-notification-silencing-rules",rel:"noopener noreferrer",target:"_blank"},"Learn how to configure silencing rules.")),!L&&a.createElement(B,null))),a.createElement(o.ModalBody,{padding:[0]},a.createElement(r.QD,null,a.createElement(o.Flex,{column:!0,gap:3},a.createElement(g,{scope:u.scope,setScope:d,padding:[0,0,1,0],isDisabled:!L}),a.createElement(v.Z,{component:"input",onChange:p,placeholder:"Add rule name",title:"Rule name*",value:u.name,disabled:!L}),a.createElement(v.Z,{component:"select",isMulti:!0,onChange:function(e){return f(e,u.roomIds)},options:b,placeholder:"Select rooms",title:"Rooms*",value:u.rooms,isDisabled:!L}),a.createElement(v.Z,{component:"select",isMulti:!0,onChange:h,options:E,placeholder:"Select nodes",title:"Nodes",value:u.nodes,isDisabled:!L||!E.length}),a.createElement(y,{hostLabels:u.hostLabels,onAddHostLabel:S,onRemoveHostLabel:k,isEdit:i,isDisabled:!L}),O?a.createElement(a.Fragment,null,a.createElement(me,null),a.createElement(v.Z,{component:"select",isMulti:!0,onChange:x("alertNames"),options:D,placeholder:"Select alert name",title:"Alert name",value:de(u.alertNames),isDisabled:!L}),a.createElement(v.Z,{component:"select",isMulti:!0,onChange:x("alertContexts"),options:C,placeholder:"Select alert context",title:"Alert context",value:de(u.alertContexts),isDisabled:!L}),a.createElement(v.Z,{component:"select",isMulti:!0,onChange:x("alertRoles"),options:Z,placeholder:"Select alert role",title:"Alert role",value:de(u.alertRoles),isDisabled:!L})):a.createElement(I,null),a.createElement(me,null),a.createElement(H,{start:u.startsAt,end:u.lastsUntil,onChange:w,isEdit:i,isDisabled:!L}))),a.createElement(r.QD,{alignItems:"end",justifyContent:"center"},a.createElement(o.Flex,{gap:4},a.createElement(o.Button,{flavour:"borderless",label:"Cancel",onClick:s,disabled:j}),L?a.createElement(m.Z,{content:i?"Update the rule":"Create the rule",align:"bottom"},a.createElement(o.Button,{label:"OK",onClick:P,"data-ga":"alert-silencing::click-save-".concat(i?"edit":"new","-rule::rule-modal"),"data-testid":"saveRule-button",textTransform:"uppercase",isLoading:j,disabled:j||!u.canSubmit})):a.createElement(m.Z,{content:"Update to a paid plan in order to be able to create silencing rules",align:"bottom"},a.createElement(o.Button,{label:"Upgrade!",onClick:A})))))))}}}]);