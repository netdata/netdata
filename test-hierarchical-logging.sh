#!/bin/bash

# Test script to demonstrate the new hierarchical logging format

echo "========================================================================================"
echo "Testing New Hierarchical Console Logging Format"
echo "========================================================================================"
echo ""
echo "The new format shows agent execution flow with clear structure:"
echo ""
echo "Format: SEVERITY turn-path DIR KIND agentPath: context message"
echo ""
echo "Where:"
echo "  SEVERITY = VRB, WRN, ERR, FIN, etc."
echo "  turn-path = Execution hierarchy with hyphenated segments (1.0-0.1, etc.)"
echo "  DIR = → (request) or ← (response)"
echo "  KIND = LLM, MCP, RST, AGN, INT"
echo "  agentPath = Colon-separated agent chain (root:child:grandchild)"
echo "  context = Optional context (model, tool, metrics)"
echo "  message = Original log message"
echo ""
echo "Examples of what you'll see:"
echo ""
echo "  VRB 0.0 ← INT web-search: session initialized"
echo "  VRB 1.0 → INT web-search: processing Say hello"
echo "  VRB 1.0 → LLM web-search: anthropic/claude-3-haiku LLM request prepared"
echo "  VRB 1.0 ← LLM web-search: 1500ms, tokens:806/79, \$0.00030 LLM response received"
echo "  VRB 1.1 → AGN web-search: agent__final_report(status:success, content:hello) Calling final_report"
echo "  VRB 1.1 ← AGN web-search: agent__final_report: 11b, 1ms Tool completed"
echo "  VRB 1.2-0.0 → AGN web-search:web-fetch: agent:progress_report(progress:Fetching article...) started"
echo "  VRB 1.2-0.1 → MCP web-search:web-fetch: fetcher:fetch_url(url:https://example.com, extractContent:true) started"
echo "  VRB 1.2-0.1 ← MCP web-search:web-fetch: fetcher:fetch_url ok preview: \"{\\\"status\\\":true,...}\""
echo "  WRN 2.0 ← LLM web-search: Turn result: hasToolCalls=true, hasToolResults=true, finalAnswer=false, ... (entire line in yellow)"
echo "  ERR 2.1 ← LLM web-search: Failed to connect to provider (entire line in red)"
echo "  FIN 1.0 ← INT web-search: session finalized"
echo ""
echo "Key Features:"
echo "- Turn Path: Hyphen-separated hierarchy (1.0-0.1-0.2, etc.)"
echo "- Agent Path: Colon-separated agent chain (web-search:web-fetch)"
echo "- LLM Calls: Shows provider/model for requests, metrics for responses"
echo "- Tool Calls: Shows tool name with parameters inline"
echo "- Metrics: Latency, tokens, cost, bytes extracted and shown concisely"
echo ""
echo "Color Coding (when running in TTY):"
echo "- Blue: LLM operations context"
echo "- Green: Tool operations context"
echo "- Yellow: ENTIRE LINE for warnings (WRN)"
echo "- Red: ENTIRE LINE for errors (ERR)"
echo "- Plain: Original messages always in plain color"
echo ""
echo "To see this in action, run with --verbose flag in a real terminal:"
echo "$ ai-agent --verbose --models anthropic/claude-3-haiku-20240307 'You are helpful' 'Say hello'"
echo ""
echo "Note: The simplified format only activates when:"
echo "1. Running in a terminal with TTY (not piped/redirected)"
echo "2. Not running in server mode (--mcp, etc.)"
echo "3. No explicit --telemetry-log-format override"
echo ""
