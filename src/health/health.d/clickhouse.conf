# you can disable an alarm notification by setting the 'to' line to: silent

 template: clickhouse_restart
       on: clickhouse.uptime
    class: Error
     type: Database
component: ClickHouse
     calc: $uptime
    units: seconds
    every: 10s
     warn: $this > 1 AND $this < 180
  summary: ClickHouse has been restarted
     info: ClickHouse has been restarted
       to: dba

 template: clickhouse_max_part_count_for_partition
       on: clickhouse.clickhouse.max_part_count_for_partition
    class: Workload
     type: Database
component: ClickHouse
   lookup: avg -1m unaligned
    units: parts
    every: 10s
     warn: $this > (($status >= $WARNING)  ? (200) : (300))
    delay: down 5m multiplier 1.5 max 1h
  summary: ClickHouse high number of parts per partition
     info: ClickHouse high number of parts per partition
       to: dba

 template: clickhouse_longest_running_query_time
       on: clickhouse.longest_running_query_time
    class: Latency
     type: Database
component: ClickHouse
   lookup: max -1m unaligned
    units: parts
    every: 10s
     warn: $this > (($status >= $WARNING)  ? (300) : (600))
    delay: down 5m multiplier 1.5 max 1h
  summary: ClickHouse has long running queries
     info: ClickHouse has queries running longer than 10 minutes
       to: dba

 template: clickhouse_replicas_max_absolute_delay
       on: clickhouse.replicas_max_absolute_delay
    class: Workload
     type: Database
component: ClickHouse
   lookup: avg -1m unaligned
    units: seconds
    every: 10s
     warn: $this > (($status >= $WARNING)  ? (250) : (300))
    delay: down 5m multiplier 1.5 max 1h
  summary: ClickHouse high replication lag
     info: ClickHouse replication lag greater than 5 minutes
       to: dba

 template: clickhouse_replicated_readonly_tables
       on: clickhouse.replicated_readonly_tables
    class: Error
     type: Database
component: ClickHouse
   lookup: max -1m unaligned
    units: seconds
    every: 10s
     warn: $this > 0
    delay: down 5m multiplier 1.5 max 1h
  summary: ClickHouse replicated tables in readonly state
     info: ClickHouse has replicated tables in readonly state due to ZooKeeper session loss/startup without ZooKeeper configured
       to: dba

 template: clickhouse_queries_preempted
       on: clickhouse.queries_preempted
    class: Workload
     type: Database
component: ClickHouse
   lookup: max -1m unaligned
    units: seconds
    every: 10s
     warn: $this > 0
    delay: down 5m multiplier 1.5 max 1h
  summary: ClickHouse preempted queries
     info: ClickHouse has queries that are stopped and waiting due to priority setting
       to: dba