disabled: yes

name: 'snmp'

discover:
  - discoverer: snmp
    snmp:
      credentials:
        - name: "public-v2c"
          version: 2
          community: "public"

        - name: "secure-v3"
          version: 3
          username: "admin"
          auth_protocol: "SHA"
          auth_password: "secret123"
          priv_protocol: "AES"
          priv_password: "encrypt123"

      networks:
        - subnet: "192.168.1.0/24"
          credential: "public-v2c"

      timeout: "2s"
      parallel_scans: 40
      rescan_interval: "30m"

classify:
  - name: "SNMP Devices"
    selector: "*"
    tags: "snmp"
    match:
      - tags: "snmp"
        expr: '{{ true }}'
compose:
  - name: "SNMP Devices"
    selector: "snmp"
    config:
      - selector: "snmp"
        template: |
          module: snmp
          update_every: 5
          name: snmp_{{ .IPAddress }}
          hostname: {{ .IPAddress }}
          options:
            version: {{ .Credential.Version }}
          {{- if eq .Credential.Version "1" "2" }}
          community: {{.Credential.Community}}
          {{- else }}
            user:
              name: {{ .Credential.UserName }}
              level: {{ .Credential.SecurityLevel }}
              auth_proto: {{ .Credential.AuthProtocol }}
              auth_key: {{ .Credential.AuthPassphrase }}
              priv_proto: {{ .Credential.PrivacyProtocol }}
              priv_key: {{ .Credential.PrivacyPassphrase }}
          {{- end }}
