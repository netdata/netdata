{
  "jsonSchema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Net Listeners Service Discovery",
    "description": "Discovers services by scanning local listening network ports.",
    "type": "object",
    "properties": {
      "name": {
        "title": "Name",
        "description": "Pipeline name (must be unique).",
        "type": "string",
        "minLength": 1
      },
      "discoverer": {
        "title": "Discoverer",
        "type": "object",
        "properties": {
          "net_listeners": {
            "title": "Net Listeners",
            "type": "object",
            "properties": {
              "interval": {
                "title": "Scan interval",
                "description": "How often to scan for listeners.",
                "type": "string",
                "pattern": "^[0-9]+(\\.[0-9]+)?(ms|s|m|h|d|w|mo|y)?$",
                "default": "2m"
              },
              "timeout": {
                "title": "Timeout",
                "description": "Timeout for local listener discovery, in seconds.",
                "type": "number",
                "minimum": 0.1,
                "default": 5
              }
            }
          }
        },
        "required": [
          "net_listeners"
        ]
      },
      "services": {
        "title": "Service rules",
        "description": "- Match discovered network listeners and generate collector configurations.\n- Each rule specifies match criteria and a config template.\n- When a listener matches, a data collection job is created.",
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "properties": {
            "id": {
              "title": "Rule ID",
              "description": "Unique identifier for this rule. Used in logs to identify which rule matched a service.",
              "type": "string"
            },
            "match": {
              "title": "Match expression",
              "description": "Go template expression that must evaluate to 'true' for the rule to match the discovered service.",
              "type": "string"
            },
            "config_template": {
              "title": "Config template",
              "description": "**Uses the same fields as match expression**. Go template that generates the data collection job configuration in YAML format. **Must include 'module' and 'name' fields**, plus any module-specific settings.",
              "type": "string"
            }
          },
          "required": [
            "id",
            "match"
          ]
        }
      }
    },
    "required": [
      "name",
      "discoverer",
      "services"
    ]
  },
  "uiSchema": {
    "uiOptions": {
      "fullPage": true
    },
    "ui:flavour": "tabs",
    "ui:options": {
      "tabs": [
        {
          "title": "Base",
          "fields": [
            "name",
            "discoverer"
          ]
        },
        {
          "title": "Services",
          "fields": [
            "services"
          ]
        }
      ]
    },
    "discoverer": {
      "net_listeners": {
        "interval": {
          "ui:placeholder": "2m",
          "ui:help": "Examples: 30s, 2m, 5m, 1h"
        },
        "timeout": {
          "ui:placeholder": "5",
          "ui:help": "Value in seconds. Examples: 5, 10, 0.5"
        }
      }
    },
    "services": {
      "ui:listFlavour": "list",
      "items": {
        "id": {
          "ui:placeholder": "nginx-http",
          "ui:help": "Use descriptive names like 'nginx-http', 'mysql-default', 'redis-local'"
        },
        "match": {
          "ui:widget": "textarea",
          "ui:placeholder": "{{ eq .Comm \"nginx\" }}",
          "ui:help": "| Field | Description |\n|-------|-------------|\n| `.Protocol` | TCP, TCP6, UDP, UDP6 |\n| `.IPAddress` | IP address |\n| `.Port` | Port number |\n| `.Address` | IP:Port combined |\n| `.Comm` | Process name |\n| `.Cmdline` | Full command line |\n\n**Functions:** eq, ne, glob, regexp, and, or, not"
        },
        "config_template": {
          "ui:widget": "textarea",
          "ui:placeholder": "module: nginx\nname: {{.Name}}-{{.Address}}\nurl: http://{{.Address}}/stub_status"
        }
      }
    }
  }
}
