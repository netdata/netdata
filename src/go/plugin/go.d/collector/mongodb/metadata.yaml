plugin_name: go.d.plugin
modules:
  - meta:
      id: collector-go.d.plugin-mongodb
      plugin_name: go.d.plugin
      module_name: mongodb
      monitored_instance:
        name: MongoDB
        link: https://www.mongodb.com/
        icon_filename: mongodb.svg
        categories:
          - data-collection.database-servers
      keywords:
        - mongodb
        - databases
      related_resources:
        integrations:
          list: []
      info_provided_to_referring_integrations:
        description: ""
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors MongoDB servers.

          Executed queries:

          - [serverStatus](https://docs.mongodb.com/manual/reference/command/serverStatus/)
          - [dbStats](https://docs.mongodb.com/manual/reference/command/dbStats/)
          - [replSetGetStatus](https://www.mongodb.com/docs/manual/reference/command/replSetGetStatus/)
        method_description: ""
      supported_platforms:
        include: []
        exclude: []
      multi_instance: true
      additional_permissions:
        description: ""
      default_behavior:
        auto_detection:
          description: ""
        limits:
          description: ""
        performance_impact:
          description: ""
    setup:
      prerequisites:
        list:
          - title: Create a read-only user
            description: |
              Create a read-only user for Netdata in the admin database.

              - Authenticate as the admin user:

                ```bash
                use admin
                db.auth("admin", "<MONGODB_ADMIN_PASSWORD>")
                ```

              - Create a user:

                ```bash
                db.createUser({
                "user":"netdata",
                "pwd": "<UNIQUE_PASSWORD>",
                "roles" : [
                {role: 'read', db: 'admin' },
                {role: 'clusterMonitor', db: 'admin'},
                {role: 'read', db: 'local' }
                ]
                })
                ```
      configuration:
        file:
          name: go.d/mongodb.conf
        options:
          description: |
            The following options can be defined globally: update_every, autodetection_retry.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection interval (seconds).
              default_value: 5
              required: false
              group: Collection
            - name: autodetection_retry
              description: Autodetection retry interval (seconds). Set 0 to disable.
              default_value: 0
              required: false
              group: Collection

            - name: uri
              description: "MongoDB connection string. See [URI syntax](https://www.mongodb.com/docs/manual/reference/connection-string/)."
              default_value: mongodb://localhost:27017
              required: true
              group: Target
            - name: timeout
              description: Query timeout (seconds).
              default_value: 1
              required: false
              group: Target

            - name: databases
              description: Database selector. Defines which databases to collect metrics from.
              default_value: ""
              required: false
              group: Filters
              details: |
                Metrics of databases matching the selector will be collected.

                - Logic: (pattern1 OR pattern2) AND !(pattern3 OR pattern4)
                - Pattern syntax: [matcher](https://github.com/netdata/netdata/tree/master/src/go/pkg/matcher#supported-format).
                - Syntax:

                  ```yaml
                  databases:
                    includes:
                      - pattern1
                      - pattern2
                    excludes:
                      - pattern3
                      - pattern4
                  ```

            - name: functions.top_queries.disabled
              description: Disable the [top-queries](#top-queries) function.
              default_value: false
              required: false
              group: Functions
            - name: functions.top_queries.timeout
              description: Query timeout (seconds). Uses collector timeout if not set.
              default_value: ""
              required: false
              group: Functions
            - name: functions.top_queries.limit
              description: Maximum number of queries to return.
              default_value: 500
              required: false
              group: Functions

            - name: vnode
              description: Associates this data collection job with a [Virtual Node](https://learn.netdata.cloud/docs/netdata-agent/configuration/organize-systems-metrics-and-alerts#virtual-nodes).
              default_value: ""
              required: false
              group: Virtual Node
        examples:
          folding:
            title: Config
            enabled: true
          list:
            - name: TCP socket
              description: An example configuration.
              config: |
                jobs:
                  - name: local
                    uri: mongodb://netdata:password@localhost:27017
            - name: With databases metrics
              description: An example configuration.
              config: |
                jobs:
                  - name: local
                    uri: mongodb://netdata:password@localhost:27017
                    databases:
                      includes:
                        - "* *"
            - name: Multi-instance
              description: |
                > **Note**: When you define multiple jobs, their names must be unique.

                Local and remote instances.
              config: |
                jobs:
                  - name: local
                    uri: mongodb://netdata:password@localhost:27017
                
                  - name: remote
                    uri: mongodb://netdata:password@203.0.113.0:27017
    troubleshooting:
      problems:
        list: []
    alerts: []
    functions:
      description: |
        This collector exposes real-time functions for interactive troubleshooting in the Top tab.
      list:
        - id: top-queries
          name: Top Queries
          description: |
            Retrieves profiled query statistics from MongoDB [system.profile](https://www.mongodb.com/docs/manual/reference/database-profiler/) collection.

            This function queries the `system.profile` collection across all user databases (excluding admin, local, config) to retrieve slow or sampled queries captured by the MongoDB profiler. It provides detailed execution metrics including timing, document counts, and execution plan information.

            Use cases:
            - Identify slow queries that exceed the profiling threshold
            - Analyze query patterns by examining docs examined vs docs returned ratios
            - Detect collection scans (COLLSCAN) that may need index optimization

            Query text is truncated at 4096 characters for display purposes.
          parameters:
            - id: __sort
              name: Filter By
              description: Select the primary sort column. Options include execution time, docs examined, keys examined, and more. Defaults to execution time to focus on slowest queries.
              type: select
              required: true
              default: execution_time
              options: []
          returns:
            description: Profiled query statistics from `system.profile`. Each row represents a single profiled operation with execution metrics and plan details.
            columns:
              - name: Timestamp
                type: timestamp
                unit: ""
                description: "When the operation was profiled. Useful for correlating slow queries with application events."
              - name: Namespace
                type: string
                unit: ""
                description: "Database and collection name in format `database.collection`. Identifies which collection the operation targeted."
              - name: Operation
                type: string
                unit: ""
                description: "Type of operation: query, insert, update, remove, command, getmore. Helps categorize workload patterns."
              - name: Query
                type: string
                unit: ""
                description: "The command document as JSON showing the query filter, projection, and options. Truncated to 4096 characters."
              - name: Execution Time
                type: duration
                unit: "seconds"
                description: "Total execution time of the operation. High values indicate slow queries that may need optimization."
              - name: Docs Examined
                type: integer
                unit: ""
                description: "Number of documents scanned during execution. A high ratio of docs examined to docs returned suggests missing or inefficient indexes."
              - name: Keys Examined
                type: integer
                unit: ""
                description: "Number of index keys scanned. Compare with docs examined to assess index efficiency."
              - name: Docs Returned
                type: integer
                unit: ""
                description: "Number of documents returned to the client. Compare with docs examined to identify inefficient queries."
              - name: Plan Summary
                type: string
                unit: ""
                description: "Execution plan summary (e.g., IXSCAN, COLLSCAN, SORT). COLLSCAN indicates a full collection scan that may need an index."
              - name: Client
                type: string
                unit: ""
                description: "Client IP address or hostname that executed the operation. Useful for identifying query sources."
              - name: User
                type: string
                unit: ""
                description: "Authenticated user who executed the operation. Empty for unauthenticated connections."
              - name: Docs Deleted
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of documents deleted by the operation. Relevant for remove operations."
              - name: Docs Inserted
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of documents inserted by the operation. Relevant for insert operations."
              - name: Docs Modified
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of documents modified by the operation. Relevant for update operations."
              - name: Response Length
                type: integer
                unit: ""
                visibility: hidden
                description: "Size of the response in bytes. Large responses may indicate queries returning excessive data."
              - name: Num Yield
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of times the operation yielded to allow other operations to proceed. High yields may indicate lock contention."
              - name: App Name
                type: string
                unit: ""
                description: "Application name from the client connection string. Useful for identifying which application generated the query."
              - name: Cursor Exhausted
                type: string
                unit: ""
                visibility: hidden
                description: "Whether the cursor was fully exhausted (Yes/No)."
              - name: Has Sort Stage
                type: string
                unit: ""
                visibility: hidden
                description: "Whether the query required an in-memory sort stage (Yes/No). In-memory sorts are slower than index-based sorts."
              - name: Uses Disk
                type: string
                unit: ""
                visibility: hidden
                description: "Whether the operation used disk for sorting or aggregation (Yes/No). Indicates memory pressure."
              - name: From Multi Planner
                type: string
                unit: ""
                visibility: hidden
                description: "Whether multiple query plans were evaluated (Yes/No)."
              - name: Replanned
                type: string
                unit: ""
                visibility: hidden
                description: "Whether the query was replanned due to plan cache eviction (Yes/No)."
              - name: Query Hash
                type: string
                unit: ""
                visibility: hidden
                description: "Hash of the query shape for identifying similar queries. Available in MongoDB 4.2+."
              - name: Plan Cache Key
                type: string
                unit: ""
                visibility: hidden
                description: "Key used for plan cache lookup. Available in MongoDB 4.2+."
              - name: Planning Time
                type: duration
                unit: "seconds"
                visibility: hidden
                description: "Time spent planning the query execution. Available in MongoDB 6.2+."
              - name: CPU Time
                type: duration
                unit: "seconds"
                visibility: hidden
                description: "CPU time consumed by the operation. Available in MongoDB 6.3+ on Linux only."
              - name: Query Framework
                type: string
                unit: ""
                visibility: hidden
                description: "Query execution framework used (classic or SBE). Available in MongoDB 7.0+."
              - name: Query Shape Hash
                type: string
                unit: ""
                visibility: hidden
                description: "Hash representing the query shape for grouping similar queries. Available in MongoDB 8.0+."
          performance: |
            Reads from `system.profile` collection across all user databases:<br/>• Profiling itself adds overhead to MongoDB operations (typically 1-5%)<br/>• Default limit of 500 rows balances usefulness with performance
          security: |
            Query text may contain unmasked literal values including potentially sensitive data:<br/>• Document field values in query filters<br/>• Personal information in inserted/updated documents<br/>• Access should be restricted to authorized personnel only
          prerequisites:
            list:
              - title: Enable MongoDB profiling
                description: |
                  Database profiling must be enabled on each database you want to monitor, and the function must be enabled in the collector configuration.

                  1. Enable profiling on a database (profile slow queries > 100ms):

                     ```javascript
                     use myDatabase
                     db.setProfilingLevel(1, { slowms: 100 })
                     ```

                  2. Or profile all operations (level 2, use with caution):

                     ```javascript
                     db.setProfilingLevel(2)
                     ```

                  3. Verify profiling status:

                     ```javascript
                     db.getProfilingStatus()
                     ```

                  4. Enable the function in Netdata collector config:

                     ```yaml
                     jobs:
                       - name: local
                         uri: mongodb://localhost:27017
                         top_queries_function_enabled: true
                     ```

                  :::info

                  - Profiling level 0 = off, 1 = slow operations only, 2 = all operations
                  - The `slowms` threshold determines which queries are captured at level 1
                  - `system.profile` is a capped collection; old entries are automatically removed
                  - System databases (admin, local, config) are excluded from profiling queries

                  :::
          availability: |
            Available when:<br/>• The collector has successfully connected to MongoDB<br/>• Profiling is enabled on at least one user database<br/>• Returns HTTP 503 if collector is still initializing or profiling is disabled on all databases<br/>• Returns HTTP 500 if the query fails<br/>• Returns HTTP 504 if the query times out
          require_cloud: true
    metrics:
      folding:
        title: Metrics
        enabled: false
      availability: []
      description: |
        - WireTiger metrics are available only if [WiredTiger](https://docs.mongodb.com/v6.0/core/wiredtiger/) is used as the
        storage engine.
        - Sharding metrics are available on shards only
        for [mongos](https://www.mongodb.com/docs/manual/reference/program/mongos/).
      scopes:
        - name: global
          description: These metrics refer to the entire monitored application.
          labels: []
          metrics:
            - name: mongodb.operations_rate
              description: Operations rate
              unit: operations/s
              chart_type: line
              dimensions:
                - name: reads
                - name: writes
                - name: commands
            - name: mongodb.operations_latency_time
              description: Operations Latency
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: reads
                - name: writes
                - name: commands
            - name: mongodb.operations_by_type_rate
              description: Operations by type
              unit: operations/s
              chart_type: line
              dimensions:
                - name: insert
                - name: query
                - name: update
                - name: delete
                - name: getmore
                - name: command
            - name: mongodb.document_operations_rate
              description: Document operations
              unit: operations/s
              chart_type: stacked
              dimensions:
                - name: inserted
                - name: deleted
                - name: returned
                - name: updated
            - name: mongodb.scanned_indexes_rate
              description: Scanned indexes
              unit: indexes/s
              chart_type: line
              dimensions:
                - name: scanned
            - name: mongodb.scanned_documents_rate
              description: Scanned documents
              unit: documents/s
              chart_type: line
              dimensions:
                - name: scanned
            - name: mongodb.active_clients_count
              description: Connected clients
              unit: clients
              chart_type: line
              dimensions:
                - name: readers
                - name: writers
            - name: mongodb.queued_operations_count
              description: Queued operations because of a lock
              unit: operations
              chart_type: line
              dimensions:
                - name: reads
                - name: writes
            - name: mongodb.cursors_open_count
              description: Open cursors
              unit: cursors
              chart_type: line
              dimensions:
                - name: open
            - name: mongodb.cursors_open_no_timeout_count
              description: Open cursors with disabled timeout
              unit: cursors
              chart_type: line
              dimensions:
                - name: open_no_timeout
            - name: mongodb.cursors_opened_rate
              description: Opened cursors rate
              unit: cursors/s
              chart_type: line
              dimensions:
                - name: opened
            - name: mongodb.cursors_timed_out_rate
              description: Timed-out cursors
              unit: cursors/s
              chart_type: line
              dimensions:
                - name: timed_out
            - name: mongodb.cursors_by_lifespan_count
              description: Cursors lifespan
              unit: cursors
              chart_type: stacked
              dimensions:
                - name: le_1s
                - name: 1s_5s
                - name: 5s_15s
                - name: 15s_30s
                - name: 30s_1m
                - name: 1m_10m
                - name: ge_10m
            - name: mongodb.transactions_count
              description: Current transactions
              unit: transactions
              chart_type: line
              dimensions:
                - name: active
                - name: inactive
                - name: open
                - name: prepared
            - name: mongodb.transactions_rate
              description: Transactions rate
              unit: transactions/s
              chart_type: line
              dimensions:
                - name: started
                - name: aborted
                - name: committed
                - name: prepared
            - name: mongodb.connections_usage
              description: Connections usage
              unit: connections
              chart_type: stacked
              dimensions:
                - name: available
                - name: used
            - name: mongodb.connections_by_state_count
              description: Connections By State
              unit: connections
              chart_type: line
              dimensions:
                - name: active
                - name: threaded
                - name: exhaust_is_master
                - name: exhaust_hello
                - name: awaiting_topology_changes
            - name: mongodb.connections_rate
              description: Connections Rate
              unit: connections/s
              chart_type: line
              dimensions:
                - name: created
            - name: mongodb.asserts_rate
              description: Raised assertions
              unit: asserts/s
              chart_type: stacked
              dimensions:
                - name: regular
                - name: warning
                - name: msg
                - name: user
                - name: tripwire
                - name: rollovers
            - name: mongodb.network_traffic_rate
              description: Network traffic
              unit: bytes/s
              chart_type: stacked
              dimensions:
                - name: in
                - name: out
            - name: mongodb.network_requests_rate
              description: Network Requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: requests
            - name: mongodb.network_slow_dns_resolutions_rate
              description: Slow DNS resolution operations
              unit: resolutions/s
              chart_type: line
              dimensions:
                - name: slow_dns
            - name: mongodb.network_slow_ssl_handshakes_rate
              description: Slow SSL handshake operations
              unit: handshakes/s
              chart_type: line
              dimensions:
                - name: slow_ssl
            - name: mongodb.memory_resident_size
              description: Used resident memory
              unit: bytes
              chart_type: line
              dimensions:
                - name: used
            - name: mongodb.memory_virtual_size
              description: Used virtual memory
              unit: bytes
              chart_type: line
              dimensions:
                - name: used
            - name: mongodb.memory_page_faults_rate
              description: Memory page faults
              unit: pgfaults/s
              chart_type: line
              dimensions:
                - name: pgfaults
            - name: mongodb.memory_tcmalloc_stats
              description: TCMalloc statistics
              unit: bytes
              chart_type: line
              dimensions:
                - name: allocated
                - name: central_cache_freelist
                - name: transfer_cache_freelist
                - name: thread_cache_freelists
                - name: pageheap_freelist
                - name: pageheap_unmapped
            - name: mongodb.wiredtiger_concurrent_read_transactions_usage
              description: Wired Tiger concurrent read transactions usage
              unit: transactions
              chart_type: stacked
              dimensions:
                - name: available
                - name: used
            - name: mongodb.wiredtiger_concurrent_write_transactions_usage
              description: Wired Tiger concurrent write transactions usage
              unit: transactions
              chart_type: stacked
              dimensions:
                - name: available
                - name: used
            - name: mongodb.wiredtiger_cache_usage
              description: Wired Tiger cache usage
              unit: bytes
              chart_type: line
              dimensions:
                - name: used
            - name: mongodb.wiredtiger_cache_dirty_space_size
              description: Wired Tiger cache dirty space size
              unit: bytes
              chart_type: line
              dimensions:
                - name: dirty
            - name: mongodb.wiredtiger_cache_io_rate
              description: Wired Tiger IO activity
              unit: pages/s
              chart_type: line
              dimensions:
                - name: read
                - name: written
            - name: mongodb.wiredtiger_cache_evictions_rate
              description: Wired Tiger cache evictions
              unit: pages/s
              chart_type: stacked
              dimensions:
                - name: unmodified
                - name: modified
            - name: mongodb.sharding_nodes_count
              description: Sharding Nodes
              unit: nodes
              chart_type: stacked
              dimensions:
                - name: shard_aware
                - name: shard_unaware
            - name: mongodb.sharding_sharded_databases_count
              description: Sharded databases
              unit: databases
              chart_type: stacked
              dimensions:
                - name: partitioned
                - name: unpartitioned
            - name: mongodb.sharding_sharded_collections_count
              description: Sharded collections
              unit: collections
              chart_type: stacked
              dimensions:
                - name: partitioned
                - name: unpartitioned
        - name: lock type
          description: These metrics refer to the lock type.
          labels:
            - name: lock_type
              description: lock type (e.g. global, database, collection, mutex)
          metrics:
            - name: mongodb.lock_acquisitions_rate
              description: Lock acquisitions
              unit: acquisitions/s
              chart_type: line
              dimensions:
                - name: shared
                - name: exclusive
                - name: intent_shared
                - name: intent_exclusive
        - name: commit type
          description: These metrics refer to the commit type.
          labels:
            - name: commit_type
              description: commit type (e.g. noShards, singleShard, singleWriteShard)
          metrics:
            - name: mongodb.transactions_commits_rate
              description: Transactions commits
              unit: commits/s
              chart_type: line
              dimensions:
                - name: success
                - name: fail
            - name: mongodb.transactions_commits_duration_time
              description: Transactions successful commits duration
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: commits
        - name: database
          description: These metrics refer to the database.
          labels:
            - name: database
              description: database name
          metrics:
            - name: mongodb.database_collection_count
              description: Database collections
              unit: collections
              chart_type: line
              dimensions:
                - name: collections
            - name: mongodb.database_indexes_count
              description: Database indexes
              unit: indexes
              chart_type: line
              dimensions:
                - name: indexes
            - name: mongodb.database_views_count
              description: Database views
              unit: views
              chart_type: line
              dimensions:
                - name: views
            - name: mongodb.database_documents_count
              description: Database documents
              unit: documents
              chart_type: line
              dimensions:
                - name: documents
            - name: mongodb.database_data_size
              description: Database data size
              unit: bytes
              chart_type: line
              dimensions:
                - name: data_size
            - name: mongodb.database_storage_size
              description: Database storage size
              unit: bytes
              chart_type: line
              dimensions:
                - name: storage_size
            - name: mongodb.database_index_size
              description: Database index size
              unit: bytes
              chart_type: line
              dimensions:
                - name: index_size
        - name: replica set member
          description: These metrics refer to the replica set member.
          labels:
            - name: repl_set_member
              description: replica set member name
          metrics:
            - name: mongodb.repl_set_member_state
              description: Replica Set member state
              unit: state
              chart_type: line
              dimensions:
                - name: primary
                - name: startup
                - name: secondary
                - name: recovering
                - name: startup2
                - name: unknown
                - name: arbiter
                - name: down
                - name: rollback
                - name: removed
            - name: mongodb.repl_set_member_health_status
              description: Replica Set member health status
              unit: status
              chart_type: line
              dimensions:
                - name: up
                - name: down
            - name: mongodb.repl_set_member_replication_lag_time
              description: Replica Set member replication lag
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: replication_lag
            - name: mongodb.repl_set_member_heartbeat_latency_time
              description: Replica Set member heartbeat latency
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: heartbeat_latency
            - name: mongodb.repl_set_member_ping_rtt_time
              description: Replica Set member ping RTT
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: ping_rtt
            - name: mongodb.repl_set_member_uptime
              description: Replica Set member uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
        - name: shard
          description: These metrics refer to the shard.
          labels:
            - name: shard_id
              description: shard id
          metrics:
            - name: mongodb.sharding_shard_chunks_count
              description: Shard chunks
              unit: chunks
              chart_type: line
              dimensions:
                - name: chunks
