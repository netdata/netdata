plugin_name: go.d.plugin
modules:
  - meta:
      id: collector-go.d.plugin-postgres
      plugin_name: go.d.plugin
      module_name: postgres
      monitored_instance:
        name: PostgreSQL
        link: https://www.postgresql.org/
        categories:
          - data-collection.database-servers
        icon_filename: postgres.svg
      related_resources:
        integrations:
          list:
            - plugin_name: apps.plugin
              module_name: apps
            - plugin_name: cgroups.plugin
              module_name: cgroups
      alternative_monitored_instances: []
      info_provided_to_referring_integrations:
        description: ""
      keywords:
        - db
        - database
        - postgres
        - postgresql
        - sql
      most_popular: true
    overview:
      multi_instance: true
      data_collection:
        metrics_description: |
          This collector monitors the activity and performance of Postgres servers, collects replication statistics, metrics for each database, table and index, and more.
        method_description: |
          It establishes a connection to the Postgres instance via a TCP or UNIX socket.
          To collect metrics for database tables and indexes, it establishes an additional connection for each discovered database.
      default_behavior:
        auto_detection:
          description: |
            By default, it detects instances running on localhost by trying to connect as root and netdata using known PostgreSQL TCP and UNIX sockets:

            - 127.0.0.1:5432
            - /var/run/postgresql/
        limits:
          description: |
            Table and index metrics are not collected for databases with more than 50 tables or 250 indexes.
            These limits can be changed in the configuration file.
        performance_impact:
          description: ""
      additional_permissions:
        description: ""
      supported_platforms:
        include: []
        exclude: []
    setup:
      prerequisites:
        list:
          - title: Create netdata user
            description: |
              Create a user with granted `pg_monitor`
              or `pg_read_all_stat` [built-in role](https://www.postgresql.org/docs/current/predefined-roles.html).

              To create the `netdata` user with these permissions, execute the following in the psql session, as a user with CREATEROLE privileges:

              ```postgresql
              CREATE USER netdata;
              GRANT pg_monitor TO netdata;
              ```

              After creating the new user, restart the Netdata Agent with `sudo systemctl restart netdata`, or
              the [appropriate method](/docs/netdata-agent/start-stop-restart.md) for your
              system.
      configuration:
        file:
          name: go.d/postgres.conf
        options:
          description: |
            The following options can be defined globally: update_every, autodetection_retry.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection interval (seconds).
              default_value: 1
              required: false
              group: Collection
            - name: autodetection_retry
              description: Autodetection retry interval (seconds). Set 0 to disable.
              default_value: 0
              required: false
              group: Collection

            - name: dsn
              description: Postgres connection string (DSN). See [DSN syntax](https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING).
              default_value: postgres://postgres:postgres@127.0.0.1:5432/postgres
              required: true
              group: Target
            - name: timeout
              description: Query timeout (seconds).
              default_value: 2
              required: false
              group: Target

            - name: collect_databases_matching
              description: Database selector. Controls which databases are included. Uses [simple patterns](https://github.com/netdata/netdata/tree/master/src/go/pkg/matcher#simple-patterns-matcher).
              default_value: ""
              required: false
              group: Filters

            - name: max_db_tables
              description: Maximum number of tables per database to collect metrics for (0 = no limit).
              default_value: 50
              required: false
              group: Limits
            - name: max_db_indexes
              description: Maximum number of indexes per database to collect metrics for (0 = no limit).
              default_value: 250
              required: false
              group: Limits

            - name: vnode
              description: Associates this data collection job with a [Virtual Node](https://learn.netdata.cloud/docs/netdata-agent/configuration/organize-systems-metrics-and-alerts#virtual-nodes).
              default_value: ""
              required: false
              group: Virtual Node
        examples:
          folding:
            title: Config
            enabled: true
          list:
            - name: TCP socket
              description: An example configuration.
              folding:
                enabled: false
              config: |
                jobs:
                  - name: local
                    dsn: 'postgresql://netdata@127.0.0.1:5432/postgres'
            - name: Unix socket
              description: An example configuration.
              config: |
                jobs:
                  - name: local
                    dsn: 'host=/var/run/postgresql dbname=postgres user=netdata'
            - name: Unix socket (custom port)
              description: Connect to PostgreSQL using a Unix socket with a non-default port (5433).
              config: |
                jobs:
                  - name: local
                    dsn: 'host=/var/run/postgresql port=5433 dbname=postgres user=netdata'
            - name: Multi-instance
              description: |
                > **Note**: When you define multiple jobs, their names must be unique.

                Local and remote instances.
              config: |
                jobs:
                  - name: local
                    dsn: 'postgresql://netdata@127.0.0.1:5432/postgres'
                
                  - name: remote
                    dsn: 'postgresql://netdata@203.0.113.0:5432/postgres'
    troubleshooting:
      problems:
        list: []
    alerts:
      - name: postgres_total_connection_utilization
        metric: postgres.connections_utilization
        info: average total connection utilization over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_acquired_locks_utilization
        metric: postgres.locks_utilization
        info: average acquired locks utilization over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_txid_exhaustion_perc
        metric: postgres.txid_exhaustion_perc
        info: percent towards TXID wraparound
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_db_cache_io_ratio
        metric: postgres.db_cache_io_ratio
        info: average cache hit ratio in db ${label:database} over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_db_transactions_rollback_ratio
        metric: postgres.db_cache_io_ratio
        info: average aborted transactions percentage in db ${label:database} over the last five minutes
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_db_deadlocks_rate
        metric: postgres.db_deadlocks_rate
        info: number of deadlocks detected in db ${label:database} in the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_cache_io_ratio
        metric: postgres.table_cache_io_ratio
        info: average cache hit ratio in db ${label:database} table ${label:table} over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_index_cache_io_ratio
        metric: postgres.table_index_cache_io_ratio
        info: average index cache hit ratio in db ${label:database} table ${label:table} over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_toast_cache_io_ratio
        metric: postgres.table_toast_cache_io_ratio
        info: average TOAST hit ratio in db ${label:database} table ${label:table} over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_toast_index_cache_io_ratio
        metric: postgres.table_toast_index_cache_io_ratio
        info: average index TOAST hit ratio in db ${label:database} table ${label:table} over the last minute
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_bloat_size_perc
        metric: postgres.table_bloat_size_perc
        info: bloat size percentage in db ${label:database} table ${label:table}
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_last_autovacuum_time
        metric: postgres.table_autovacuum_since_time
        info: time elapsed since db ${label:database} table ${label:table} was vacuumed by the autovacuum daemon
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_table_last_autoanalyze_time
        metric: postgres.table_autoanalyze_since_time
        info: time elapsed since db ${label:database} table ${label:table} was analyzed by the autovacuum daemon
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
      - name: postgres_index_bloat_size_perc
        metric: postgres.index_bloat_size_perc
        info: bloat size percentage in db ${label:database} table ${label:table} index ${label:index}
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/postgres.conf
    functions:
      description: |
        This collector exposes real-time functions for interactive troubleshooting in the Top tab.
      list:
        - id: top-queries
          name: Top Queries
          description: |
            Retrieves aggregated SQL query performance metrics from PostgreSQL using either [pg_stat_monitor](https://docs.percona.com/pg-stat-monitor/) (preferred) or [pg_stat_statements](https://www.postgresql.org/docs/current/pgstatstatements.html).

            The collector automatically detects which extension is available:
            - **pg_stat_monitor** (Percona): Enhanced statistics with additional columns like application name, client IP, CPU time, error info, and query classification
            - **pg_stat_statements** (standard): Core execution statistics available in all PostgreSQL installations

            Statistics include execution counts, timing metrics, I/O operations, and resource consumption. Columns are dynamically detected based on your PostgreSQL version and available extension.

            Use cases:
            - Identify slow queries consuming the most total execution time
            - Find queries with high shared block reads for I/O optimization
            - Analyze temp block usage to detect queries needing memory tuning
            - With pg_stat_monitor: Track queries by application, identify error patterns

            Query text is truncated at 4096 characters for display purposes.
          parameters:
            - id: __sort
              name: Filter By
              description: Select the primary sort column. Options include total time, mean time, calls, rows, shared blocks hit/read, and temp blocks written. Defaults to total time to focus on most resource-intensive queries.
              type: select
              required: true
              default: totalTime
              options: []
          returns:
            description: Aggregated query statistics from `pg_stat_statements` or `pg_stat_monitor`. Each row represents a unique query pattern with cumulative metrics across all executions.
            columns:
              - name: Query ID
                type: string
                unit: ""
                visibility: hidden
                description: "Internal hash identifier for the normalized query. Can be used to track queries across statistics resets."
              - name: Query
                type: string
                unit: ""
                description: "Normalized SQL query text with literals replaced by parameter placeholders. Truncated to 4096 characters."
              - name: Database
                type: string
                unit: ""
                description: "Database name where the query was executed."
              - name: User
                type: string
                unit: ""
                description: "PostgreSQL user who executed the query."
              - name: Calls
                type: integer
                unit: ""
                description: "Total number of times this query pattern has been executed. High values indicate frequently run queries."
              - name: Total Time
                type: duration
                unit: "milliseconds"
                description: "Cumulative execution time across all executions. High values indicate queries consuming significant database resources."
              - name: Mean Time
                type: duration
                unit: "milliseconds"
                description: "Average execution time per call. Use this to compare typical performance across different query patterns."
              - name: Min Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Minimum execution time observed for a single execution."
              - name: Max Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Maximum execution time observed for a single execution. Large gaps between min and max may indicate performance variability."
              - name: Stddev Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Standard deviation of execution time. High values indicate inconsistent query performance."
              - name: Plans
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of times the query was planned. Available in PostgreSQL 13+."
              - name: Total Plan Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Cumulative time spent planning the query. Available in PostgreSQL 13+."
              - name: Mean Plan Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Average time spent planning per execution. Available in PostgreSQL 13+."
              - name: Min Plan Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Minimum planning time observed. Available in PostgreSQL 13+."
              - name: Max Plan Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Maximum planning time observed. Available in PostgreSQL 13+."
              - name: Stddev Plan Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Standard deviation of planning time. Available in PostgreSQL 13+."
              - name: Rows
                type: integer
                unit: ""
                description: "Total number of rows retrieved or affected across all executions."
              - name: Shared Blocks Hit
                type: integer
                unit: ""
                description: "Total shared buffer cache hits. High values indicate good cache utilization."
              - name: Shared Blocks Read
                type: integer
                unit: ""
                description: "Total shared blocks read from disk. High values indicate queries that bypass the cache and may benefit from more `shared_buffers`."
              - name: Shared Blocks Dirtied
                type: integer
                unit: ""
                visibility: hidden
                description: "Total shared blocks dirtied by the query."
              - name: Shared Blocks Written
                type: integer
                unit: ""
                visibility: hidden
                description: "Total shared blocks written by the query."
              - name: Local Blocks Hit
                type: integer
                unit: ""
                visibility: hidden
                description: "Total local buffer cache hits (temporary tables)."
              - name: Local Blocks Read
                type: integer
                unit: ""
                visibility: hidden
                description: "Total local blocks read from disk."
              - name: Local Blocks Dirtied
                type: integer
                unit: ""
                visibility: hidden
                description: "Total local blocks dirtied."
              - name: Local Blocks Written
                type: integer
                unit: ""
                visibility: hidden
                description: "Total local blocks written."
              - name: Temp Blocks Read
                type: integer
                unit: ""
                description: "Total temp blocks read. Non-zero values indicate queries spilling to disk due to insufficient `work_mem`."
              - name: Temp Blocks Written
                type: integer
                unit: ""
                description: "Total temp blocks written. High values suggest increasing `work_mem` may improve performance."
              - name: Block Read Time
                type: duration
                unit: "milliseconds"
                description: "Time spent reading blocks from disk. Requires `track_io_timing` to be enabled."
              - name: Block Write Time
                type: duration
                unit: "milliseconds"
                description: "Time spent writing blocks to disk. Requires `track_io_timing` to be enabled."
              - name: WAL Records
                type: integer
                unit: ""
                visibility: hidden
                description: "Total number of WAL records generated. Available in PostgreSQL 13+."
              - name: WAL Full Page Images
                type: integer
                unit: ""
                visibility: hidden
                description: "Total number of WAL full page images generated. Available in PostgreSQL 13+."
              - name: WAL Bytes
                type: integer
                unit: ""
                visibility: hidden
                description: "Total bytes of WAL generated. Available in PostgreSQL 13+."
              - name: JIT Functions
                type: integer
                unit: ""
                visibility: hidden
                description: "Total number of functions JIT-compiled. Available in PostgreSQL 15+."
              - name: JIT Generation Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Time spent generating JIT code. Available in PostgreSQL 15+."
              - name: JIT Inlining Count
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of times JIT inlining was performed. Available in PostgreSQL 15+."
              - name: JIT Inlining Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Time spent on JIT inlining. Available in PostgreSQL 15+."
              - name: JIT Optimization Count
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of times JIT optimization was performed. Available in PostgreSQL 15+."
              - name: JIT Optimization Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Time spent on JIT optimization. Available in PostgreSQL 15+."
              - name: JIT Emission Count
                type: integer
                unit: ""
                visibility: hidden
                description: "Number of times JIT code was emitted. Available in PostgreSQL 15+."
              - name: JIT Emission Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Time spent emitting JIT code. Available in PostgreSQL 15+."
              - name: Temp Block Read Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Time spent reading temp blocks. Available in PostgreSQL 15+. Requires `track_io_timing`."
              - name: Temp Block Write Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "Time spent writing temp blocks. Available in PostgreSQL 15+. Requires `track_io_timing`."
              - name: Application Name
                type: string
                unit: ""
                description: "Name of the application that executed the query. Available with pg_stat_monitor only."
              - name: Client IP
                type: string
                unit: ""
                visibility: hidden
                description: "IP address of the client that executed the query. Available with pg_stat_monitor only."
              - name: Command Type
                type: string
                unit: ""
                description: "Type of SQL command (SELECT, INSERT, UPDATE, DELETE, etc.). Available with pg_stat_monitor only."
              - name: Comments
                type: string
                unit: ""
                visibility: hidden
                description: "SQL comments extracted from the query. Available with pg_stat_monitor only."
              - name: Relations
                type: string
                unit: ""
                visibility: hidden
                description: "Tables/relations involved in the query. Available with pg_stat_monitor only."
              - name: CPU User Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "CPU time spent in user mode. Available with pg_stat_monitor only."
              - name: CPU System Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: "CPU time spent in system/kernel mode. Available with pg_stat_monitor only."
              - name: Error Level
                type: integer
                unit: ""
                visibility: hidden
                description: "PostgreSQL error level if query produced an error. Available with pg_stat_monitor only."
              - name: SQL Code
                type: string
                unit: ""
                visibility: hidden
                description: "PostgreSQL SQLSTATE error code if query produced an error. Available with pg_stat_monitor only."
              - name: Error Message
                type: string
                unit: ""
                visibility: hidden
                description: "Error message if query produced an error. Available with pg_stat_monitor only."
              - name: Top Level
                type: string
                unit: ""
                visibility: hidden
                description: "Whether this is a top-level statement (true) or nested (false). Available with pg_stat_monitor only."
              - name: Bucket Start Time
                type: string
                unit: ""
                visibility: hidden
                description: "Start time of the statistics bucket. Available with pg_stat_monitor only."
          performance: |
            Queries `pg_stat_statements` or `pg_stat_monitor` which maintain statistics in shared memory:<br/>• On busy servers with many unique queries, the extension may consume significant memory<br/>• Default limit of 500 rows balances usefulness with performance<br/>• pg_stat_monitor uses time-based buckets which may have different memory characteristics
          security: |
            Query text may contain unmasked literal values including potentially sensitive data:<br/>• Personal information in WHERE clauses or INSERT values<br/>• Business data and internal identifiers<br/>• Access should be restricted to authorized personnel only
          prerequisites:
            list:
              - title: Enable pg_stat_statements or pg_stat_monitor
                description: |
                  Either `pg_stat_statements` (standard) or `pg_stat_monitor` (Percona) must be installed. The collector auto-detects which is available, preferring pg_stat_monitor when both are present.

                  **Option 1: pg_stat_statements (standard PostgreSQL)**

                  1. Add to `postgresql.conf`:

                     ```ini
                     shared_preload_libraries = 'pg_stat_statements'
                     ```

                  2. Restart PostgreSQL, then create the extension:

                     ```sql
                     CREATE EXTENSION pg_stat_statements;
                     ```

                  **Option 2: pg_stat_monitor (Percona - recommended)**

                  Provides additional columns: application name, client IP, CPU time, error tracking, and query classification.

                  1. Install pg_stat_monitor (available in Percona distribution or as separate package)

                  2. Add to `postgresql.conf`:

                     ```ini
                     shared_preload_libraries = 'pg_stat_monitor'
                     ```

                  3. Restart PostgreSQL, then create the extension:

                     ```sql
                     CREATE EXTENSION pg_stat_monitor;
                     ```

                  :::info

                  - Both extensions require a server restart to load the shared library
                  - Statistics can be reset with `SELECT pg_stat_statements_reset()` or `SELECT pg_stat_monitor_reset()`
                  - Enable `track_io_timing` for block read/write timing metrics

                  :::
          availability: |
            Available when:<br/>• Either `pg_stat_statements` or `pg_stat_monitor` extension is installed<br/>• The collector has successfully connected to PostgreSQL<br/>• Returns HTTP 503 if no query statistics extension is installed<br/>• Returns HTTP 500 if the query fails<br/>• Returns HTTP 504 if the query times out
          require_cloud: true
        - id: running-queries
          name: Running Queries
          description: |
            Retrieves currently executing queries from PostgreSQL [pg_stat_activity](https://www.postgresql.org/docs/current/monitoring-stats.html#MONITORING-PG-STAT-ACTIVITY-VIEW) system view.

            This function queries `pg_stat_activity` which shows real-time information about each server process including the SQL query being executed, wait events, and session state. Unlike Top Queries which shows aggregated historical statistics, Running Queries shows live snapshots of active queries.

            Use cases:
            - Identify long-running queries that may be blocking other operations
            - Debug stuck transactions or hanging connections
            - Monitor active workload during performance issues
            - Investigate wait events and lock contention in real-time

            Query text is truncated at 4096 characters for display purposes.
          parameters:
            - id: __sort
              name: Sort By
              description: Select the sort column. Defaults to query duration (longest running first).
              type: select
              required: true
              default: durationMs
              options: []
          returns:
            description: Live query data from `pg_stat_activity`. Each row represents a currently active backend process.
            columns:
              - name: PID
                type: integer
                unit: ""
                description: "Process ID of this backend."
              - name: Leader PID
                type: integer
                unit: ""
                visibility: hidden
                description: "Process ID of parallel group leader (NULL if this is leader or not parallel). Available in PostgreSQL 13+."
              - name: Database ID
                type: integer
                unit: ""
                visibility: hidden
                description: "OID of the database this backend is connected to."
              - name: Database
                type: string
                unit: ""
                description: "Name of the database this backend is connected to."
              - name: User ID
                type: integer
                unit: ""
                visibility: hidden
                description: "OID of the user logged into this backend."
              - name: User
                type: string
                unit: ""
                description: "Name of the user logged into this backend."
              - name: Application Name
                type: string
                unit: ""
                description: "Name of the application connected to this backend."
              - name: Client Address
                type: string
                unit: ""
                description: "IP address of the client (NULL for Unix socket or internal process)."
              - name: Client Hostname
                type: string
                unit: ""
                visibility: hidden
                description: "Hostname of the client via reverse DNS (only if log_hostname enabled)."
              - name: Client Port
                type: integer
                unit: ""
                visibility: hidden
                description: "TCP port of client (-1 for Unix socket, NULL for internal process)."
              - name: Backend Start
                type: timestamp
                unit: ""
                visibility: hidden
                description: "Time when this process/connection started."
              - name: Transaction Start
                type: timestamp
                unit: ""
                visibility: hidden
                description: "Time when current transaction started (NULL if no transaction)."
              - name: Query Start
                type: timestamp
                unit: ""
                description: "Time when the currently active query was started."
              - name: State Change
                type: timestamp
                unit: ""
                visibility: hidden
                description: "Time when state was last changed."
              - name: Duration
                type: duration
                unit: "milliseconds"
                description: "Query duration in milliseconds (since query_start). High values indicate long-running queries."
              - name: Wait Event Type
                type: string
                unit: ""
                description: "Type of event the backend is waiting for (Activity, BufferPin, Client, Extension, IO, IPC, Lock, LWLock, Timeout)."
              - name: Wait Event
                type: string
                unit: ""
                description: "Specific wait event name if backend is currently waiting."
              - name: State
                type: string
                unit: ""
                description: "Current state: active, idle, idle in transaction, idle in transaction (aborted), fastpath function call, disabled."
              - name: Backend Xid
                type: string
                unit: ""
                visibility: hidden
                description: "Top-level transaction identifier of this backend."
              - name: Backend Xmin
                type: string
                unit: ""
                visibility: hidden
                description: "Backend's xmin horizon."
              - name: Query ID
                type: string
                unit: ""
                visibility: hidden
                description: "Query identifier (requires compute_query_id or extension). Available in PostgreSQL 14+."
              - name: Query
                type: string
                unit: ""
                description: "Query text of the currently executing or most recent query. May be truncated at track_activity_query_size."
              - name: Backend Type
                type: string
                unit: ""
                description: "Type of backend: client backend, autovacuum worker, parallel worker, walsender, walreceiver, etc. Available in PostgreSQL 10+."
          performance: |
            Queries `pg_stat_activity` which is a live system view:<br/>• Very lightweight query, no impact on database performance<br/>• Returns only active queries by default (state = 'active')<br/>• Limited to 500 rows
          security: |
            Query text contains actual SQL being executed, which may include:<br/>• Personal information in WHERE clauses or INSERT values<br/>• Business data and internal identifiers<br/>• Access should be restricted to authorized personnel only
          prerequisites:
            list:
              - title: Database user permissions
                description: |
                  The monitoring user needs `pg_monitor` role to view all sessions:

                  ```sql
                  GRANT pg_monitor TO netdata;
                  ```

                  Without this role, the user can only see their own sessions.
          availability: |
            Available when:<br/>• The collector has successfully connected to PostgreSQL<br/>• Returns HTTP 503 if collector is still initializing<br/>• Returns HTTP 500 if the query fails<br/>• Returns HTTP 504 if the query times out
          require_cloud: true
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: ""
      availability: []
      scopes:
        - name: global
          description: These metrics refer to the entire monitored application.
          labels: []
          metrics:
            - name: postgres.connections_utilization
              description: Connections utilization
              unit: percentage
              chart_type: line
              dimensions:
                - name: used
            - name: postgres.connections_usage
              description: Connections usage
              unit: connections
              chart_type: stacked
              dimensions:
                - name: available
                - name: used
            - name: postgres.connections_state_count
              description: Connections in each state
              unit: connections
              chart_type: stacked
              dimensions:
                - name: active
                - name: idle
                - name: idle_in_transaction
                - name: idle_in_transaction_aborted
                - name: disabled
            - name: postgres.transactions_duration
              description: Observed transactions time
              unit: transactions/s
              chart_type: stacked
              dimensions:
                - name: a dimension per bucket
            - name: postgres.queries_duration
              description: Observed active queries time
              unit: queries/s
              chart_type: stacked
              dimensions:
                - name: a dimension per bucket
            - name: postgres.locks_utilization
              description: Acquired locks utilization
              unit: percentage
              chart_type: line
              dimensions:
                - name: used
            - name: postgres.checkpoints_rate
              description: Checkpoints
              unit: checkpoints/s
              chart_type: stacked
              dimensions:
                - name: scheduled
                - name: requested
            - name: postgres.checkpoints_time
              description: Checkpoint time
              unit: milliseconds
              chart_type: stacked
              dimensions:
                - name: write
                - name: sync
            - name: postgres.bgwriter_halts_rate
              description: Background writer scan halts
              unit: events/s
              chart_type: line
              dimensions:
                - name: maxwritten
            - name: postgres.buffers_io_rate
              description: Buffers written rate
              unit: B/s
              chart_type: area
              dimensions:
                - name: checkpoint
                - name: backend
                - name: bgwriter
            - name: postgres.buffers_backend_fsync_rate
              description: Backend fsync calls
              unit: calls/s
              chart_type: line
              dimensions:
                - name: fsync
            - name: postgres.buffers_allocated_rate
              description: Buffers allocated
              unit: B/s
              chart_type: line
              dimensions:
                - name: allocated
            - name: postgres.wal_io_rate
              description: Write-Ahead Log writes
              unit: B/s
              chart_type: line
              dimensions:
                - name: write
            - name: postgres.wal_files_count
              description: Write-Ahead Log files
              unit: files
              chart_type: stacked
              dimensions:
                - name: written
                - name: recycled
            - name: postgres.wal_archiving_files_count
              description: Write-Ahead Log archived files
              unit: files/s
              chart_type: stacked
              dimensions:
                - name: ready
                - name: done
            - name: postgres.autovacuum_workers_count
              description: Autovacuum workers
              unit: workers
              chart_type: line
              dimensions:
                - name: analyze
                - name: vacuum_analyze
                - name: vacuum
                - name: vacuum_freeze
                - name: brin_summarize
            - name: postgres.txid_exhaustion_towards_autovacuum_perc
              description: Percent towards emergency autovacuum
              unit: percentage
              chart_type: line
              dimensions:
                - name: emergency_autovacuum
            - name: postgres.txid_exhaustion_perc
              description: Percent towards transaction ID wraparound
              unit: percentage
              chart_type: line
              dimensions:
                - name: txid_exhaustion
            - name: postgres.txid_exhaustion_oldest_txid_num
              description: Oldest transaction XID
              chart_type: line
              unit: xid
              dimensions:
                - name: xid
            - name: postgres.catalog_relations_count
              description: Relation count
              unit: relations
              chart_type: stacked
              dimensions:
                - name: ordinary_table
                - name: index
                - name: sequence
                - name: toast_table
                - name: view
                - name: materialized_view
                - name: composite_type
                - name: foreign_table
                - name: partitioned_table
                - name: partitioned_index
            - name: postgres.catalog_relations_size
              description: Relation size
              unit: B
              chart_type: stacked
              dimensions:
                - name: ordinary_table
                - name: index
                - name: sequence
                - name: toast_table
                - name: view
                - name: materialized_view
                - name: composite_type
                - name: foreign_table
                - name: partitioned_table
                - name: partitioned_index
            - name: postgres.uptime
              description: Uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
            - name: postgres.databases_count
              description: Number of databases
              unit: databases
              chart_type: line
              dimensions:
                - name: databases
        - name: repl application
          description: These metrics refer to the replication application.
          labels:
            - name: application
              description: application name
          metrics:
            - name: postgres.replication_app_wal_lag_size
              description: Standby application WAL lag size
              unit: B
              chart_type: line
              dimensions:
                - name: sent_lag
                - name: write_lag
                - name: flush_lag
                - name: replay_lag
            - name: postgres.replication_app_wal_lag_time
              description: Standby application WAL lag time
              unit: seconds
              chart_type: line
              dimensions:
                - name: write_lag
                - name: flush_lag
                - name: replay_lag
        - name: repl slot
          description: These metrics refer to the replication slot.
          labels:
            - name: slot
              description: replication slot name
          metrics:
            - name: postgres.replication_slot_files_count
              description: Replication slot files
              unit: files
              chart_type: line
              dimensions:
                - name: wal_keep
                - name: pg_replslot_files
        - name: database
          description: These metrics refer to the database.
          labels:
            - name: database
              description: database name
          metrics:
            - name: postgres.db_transactions_ratio
              description: Database transactions ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: committed
                - name: rollback
            - name: postgres.db_transactions_rate
              description: Database transactions
              unit: transactions/s
              chart_type: line
              dimensions:
                - name: committed
                - name: rollback
            - name: postgres.db_connections_utilization
              description: Database connections utilization
              unit: percentage
              chart_type: line
              dimensions:
                - name: used
            - name: postgres.db_connections_count
              description: Database connections
              unit: connections
              chart_type: line
              dimensions:
                - name: connections
            - name: postgres.db_cache_io_ratio
              description: Database buffer cache miss ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: miss
            - name: postgres.db_io_rate
              description: Database reads
              unit: B/s
              chart_type: line
              dimensions:
                - name: memory
                - name: disk
            - name: postgres.db_ops_fetched_rows_ratio
              description: Database rows fetched ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: fetched
            - name: postgres.db_ops_read_rows_rate
              description: Database rows read
              unit: rows/s
              chart_type: line
              dimensions:
                - name: returned
                - name: fetched
            - name: postgres.db_ops_write_rows_rate
              description: Database rows written
              unit: rows/s
              chart_type: line
              dimensions:
                - name: inserted
                - name: deleted
                - name: updated
            - name: postgres.db_conflicts_rate
              description: Database canceled queries
              unit: queries/s
              chart_type: line
              dimensions:
                - name: conflicts
            - name: postgres.db_conflicts_reason_rate
              description: Database canceled queries by reason
              unit: queries/s
              chart_type: line
              dimensions:
                - name: tablespace
                - name: lock
                - name: snapshot
                - name: bufferpin
                - name: deadlock
            - name: postgres.db_deadlocks_rate
              description: Database deadlocks
              unit: deadlocks/s
              chart_type: line
              dimensions:
                - name: deadlocks
            - name: postgres.db_locks_held_count
              description: Database locks held
              unit: locks
              chart_type: stacked
              dimensions:
                - name: access_share
                - name: row_share
                - name: row_exclusive
                - name: share_update
                - name: share
                - name: share_row_exclusive
                - name: exclusive
                - name: access_exclusive
            - name: postgres.db_locks_awaited_count
              description: Database locks awaited
              unit: locks
              chart_type: stacked
              dimensions:
                - name: access_share
                - name: row_share
                - name: row_exclusive
                - name: share_update
                - name: share
                - name: share_row_exclusive
                - name: exclusive
                - name: access_exclusive
            - name: postgres.db_temp_files_created_rate
              description: Database created temporary files
              unit: files/s
              chart_type: line
              dimensions:
                - name: created
            - name: postgres.db_temp_files_io_rate
              description: Database temporary files data written to disk
              unit: B/s
              chart_type: line
              dimensions:
                - name: written
            - name: postgres.db_size
              description: Database size
              unit: B
              chart_type: line
              dimensions:
                - name: size
        - name: table
          description: These metrics refer to the database table.
          labels:
            - name: database
              description: database name
            - name: schema
              description: schema name
            - name: table
              description: table name
            - name: parent_table
              description: parent table name
          metrics:
            - name: postgres.table_rows_dead_ratio
              description: Table dead rows
              unit: percentage
              chart_type: line
              dimensions:
                - name: dead
            - name: postgres.table_rows_count
              description: Table total rows
              unit: rows
              chart_type: line
              dimensions:
                - name: live
                - name: dead
            - name: postgres.table_ops_rows_rate
              description: Table throughput
              unit: rows/s
              chart_type: line
              dimensions:
                - name: inserted
                - name: deleted
                - name: updated
            - name: postgres.table_ops_rows_hot_ratio
              description: Table HOT updates ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: hot
            - name: postgres.table_ops_rows_hot_rate
              description: Table HOT updates
              unit: rows/s
              chart_type: line
              dimensions:
                - name: hot
            - name: postgres.table_cache_io_ratio
              description: Table I/O cache miss ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: miss
            - name: postgres.table_io_rate
              description: Table I/O
              unit: B/s
              chart_type: line
              dimensions:
                - name: memory
                - name: disk
            - name: postgres.table_index_cache_io_ratio
              description: Table index I/O cache miss ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: miss
            - name: postgres.table_index_io_rate
              description: Table index I/O
              unit: B/s
              chart_type: line
              dimensions:
                - name: memory
                - name: disk
            - name: postgres.table_toast_cache_io_ratio
              description: Table TOAST I/O cache miss ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: miss
            - name: postgres.table_toast_io_rate
              description: Table TOAST I/O
              unit: B/s
              chart_type: line
              dimensions:
                - name: memory
                - name: disk
            - name: postgres.table_toast_index_cache_io_ratio
              description: Table TOAST index I/O cache miss ratio
              unit: percentage
              chart_type: line
              dimensions:
                - name: miss
            - name: postgres.table_toast_index_io_rate
              description: Table TOAST index I/O
              unit: B/s
              chart_type: line
              dimensions:
                - name: memory
                - name: disk
            - name: postgres.table_scans_rate
              description: Table scans
              unit: scans/s
              chart_type: line
              dimensions:
                - name: index
                - name: sequential
            - name: postgres.table_scans_rows_rate
              description: Table live rows fetched by scans
              unit: rows/s
              chart_type: line
              dimensions:
                - name: index
                - name: sequential
            - name: postgres.table_autovacuum_since_time
              description: Table time since last auto VACUUM
              unit: seconds
              chart_type: line
              dimensions:
                - name: time
            - name: postgres.table_vacuum_since_time
              description: Table time since last manual VACUUM
              unit: seconds
              chart_type: line
              dimensions:
                - name: time
            - name: postgres.table_autoanalyze_since_time
              description: Table time since last auto ANALYZE
              unit: seconds
              chart_type: line
              dimensions:
                - name: time
            - name: postgres.table_analyze_since_time
              description: Table time since last manual ANALYZE
              unit: seconds
              chart_type: line
              dimensions:
                - name: time
            - name: postgres.table_null_columns
              description: Table null columns
              unit: columns
              chart_type: line
              dimensions:
                - name: "null"
            - name: postgres.table_size
              description: Table total size
              unit: B
              chart_type: line
              dimensions:
                - name: size
            - name: postgres.table_bloat_size_perc
              description: Table bloat size percentage
              unit: percentage
              chart_type: line
              dimensions:
                - name: bloat
            - name: postgres.table_bloat_size
              description: Table bloat size
              unit: B
              chart_type: line
              dimensions:
                - name: bloat
        - name: index
          description: These metrics refer to the table index.
          labels:
            - name: database
              description: database name
            - name: schema
              description: schema name
            - name: table
              description: table name
            - name: parent_table
              description: parent table name
            - name: index
              description: index name
          metrics:
            - name: postgres.index_size
              description: Index size
              unit: B
              chart_type: line
              dimensions:
                - name: size
            - name: postgres.index_bloat_size_perc
              description: Index bloat size percentage
              unit: percentage
              chart_type: line
              dimensions:
                - name: bloat
            - name: postgres.index_bloat_size
              description: Index bloat size
              unit: B
              chart_type: line
              dimensions:
                - name: bloat
            - name: postgres.index_usage_status
              description: Index usage status
              unit: status
              chart_type: line
              dimensions:
                - name: used
                - name: unused
