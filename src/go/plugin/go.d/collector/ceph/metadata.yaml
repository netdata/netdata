plugin_name: go.d.plugin
modules:
  - meta:
      plugin_name: go.d.plugin
      module_name: ceph
      monitored_instance:
        name: Ceph
        link: "https://ceph.io/"
        categories:
          - data-collection.storage-mount-points-and-filesystems
        icon_filename: "ceph.svg"
      related_resources:
        integrations:
          list: []
      info_provided_to_referring_integrations:
        description: ""
      keywords:
        - ceph
        - storage
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors the overall health status and performance of your Ceph clusters.
          It gathers key metrics for the entire cluster, individual Pools, and OSDs.
        method_description: |
          It collects metrics by periodically issuing HTTP GET requests to the Ceph Manager [REST API](https://docs.ceph.com/en/reef/mgr/ceph_api/#):

          - [/api/monitor](https://docs.ceph.com/en/reef/mgr/ceph_api/#get--api-monitor) (only once to get the Ceph cluster id (fsid))          
          - [/api/health/minimal](https://docs.ceph.com/en/reef/mgr/ceph_api/#get--api-health-minimal)
          - [/api/osd](https://docs.ceph.com/en/reef/mgr/ceph_api/#get--api-osd)
          - [/api/pool?stats=true](https://docs.ceph.com/en/reef/mgr/ceph_api/#get--api-pool)
      supported_platforms:
        include: [Linux]
        exclude: []
      multi_instance: true
      additional_permissions:
        description: ""
      default_behavior:
        auto_detection:
          description: |
            The collector can automatically detect Ceph Manager instances running on:

            - localhost that are listening on port 8443
            - within Docker containers
            
            > **Note that the Ceph REST API requires a username and password**. 
            > While Netdata can automatically detect Ceph Manager instances and create data collection jobs, these jobs will fail unless you provide the necessary credentials.
        limits:
          description: ""
        performance_impact:
          description: ""
    setup:
      prerequisites:
        list: []
      configuration:
        file:
          name: go.d/ceph.conf
        options:
          description: |
            The following options can be defined globally: update_every.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection interval (seconds).
              default_value: 1
              required: false
              group: Base
            - name: autodetection_retry
              description: Autodetection retry interval (seconds). Set 0 to disable.
              default_value: 0
              required: false
              group: Base
            - name: url
              description: The URL of the [Ceph Manager API](https://docs.ceph.com/en/reef/mgr/ceph_api/).
              default_value: https://127.0.0.1:8443
              required: true
              group: Base
            - name: timeout
              description: HTTP request timeout (seconds).
              default_value: 2
              required: false
              group: Base

            - name: username
              description: Username for Basic HTTP authentication.
              default_value: ""
              required: true
              group: HTTP Auth
            - name: password
              description: Password for Basic HTTP authentication.
              default_value: ""
              required: true
              group: HTTP Auth
            - name: bearer_token_file
              description: "Path to a file containing a bearer token (used for `Authorization: Bearer`)."
              default_value: ""
              required: false
              group: HTTP Auth

            - name: tls_skip_verify
              description: Skip TLS certificate and hostname verification (insecure).
              default_value: yes
              required: false
              group: TLS
            - name: tls_ca
              description: Path to CA bundle used to validate the server certificate.
              default_value: ""
              required: false
              group: TLS
            - name: tls_cert
              description: Path to client TLS certificate (for mTLS).
              default_value: ""
              required: false
              group: TLS
            - name: tls_key
              description: Path to client TLS private key (for mTLS).
              default_value: ""
              required: false
              group: TLS

            - name: proxy_url
              description: HTTP proxy URL.
              default_value: ""
              required: false
              group: Proxy
            - name: proxy_username
              description: Username for proxy Basic HTTP authentication.
              default_value: ""
              required: false
              group: Proxy
            - name: proxy_password
              description: Password for proxy Basic HTTP authentication.
              default_value: ""
              required: false
              group: Proxy

            - name: method
              description: HTTP method to use.
              default_value: GET
              required: false
              group: Request
            - name: body
              description: Request body (e.g., for POST/PUT).
              default_value: ""
              required: false
              group: Request
            - name: headers
              description: "Additional HTTP headers (one per line as key: value)."
              default_value: ""
              required: false
              group: Request
            - name: not_follow_redirects
              description: Do not follow HTTP redirects.
              default_value: no
              required: false
              group: Request
            - name: force_http2
              description: Force HTTP/2 (including h2c over TCP).
              default_value: no
              required: false
              group: Request

            - name: vnode
              description: Associates this data collection job with a [Virtual Node](https://learn.netdata.cloud/docs/netdata-agent/configuration/organize-systems-metrics-and-alerts#virtual-nodes).
              default_value: ""
              required: false
              group: Virtual Node
        examples:
          folding:
            title: ""
            enabled: false
          list:
            - name: Basic
              description: A basic example configuration.
              folding:
                enabled: false
              config: |
                jobs:
                  - name: local
                    url: https://127.0.0.1:8443
                    username: user
                    password: pass
            - name: Multi-instance
              description: |
                > **Note**: When you define multiple jobs, their names must be unique.
                
                Collecting metrics from local and remote instances.
              config: |
                jobs:
                  - name: local
                    url: https://127.0.0.1:8443
                    username: user
                    password: pass
                
                  - name: remote
                    url: https://192.0.2.1:8443
                    username: user
                    password: pass
    troubleshooting:
      problems:
        list: []
    alerts:
      - name: ceph_cluster_physical_capacity_utilization
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/ceph.conf
        metric: ceph.cluster_physical_capacity_utilization
        info: 'Ceph cluster ${label:fsid} disk space utilization'
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: ""
      availability: []
      scopes:
        - name: cluster
          description: "These metrics refer to the entire Ceph cluster."
          labels:
            - name: fsid
              description: A unique identifier of the cluster.
          metrics:
            - name: ceph.cluster_status
              description: Ceph Cluster Status
              unit: status
              chart_type: line
              dimensions:
                - name: ok
                - name: err
                - name: warn
            - name: ceph.cluster_hosts_count
              description: Ceph Cluster Hosts
              unit: hosts
              chart_type: line
              dimensions:
                - name: hosts
            - name: ceph.cluster_monitors_count
              description: Ceph Cluster Monitors
              unit: monitors
              chart_type: line
              dimensions:
                - name: monitors
            - name: ceph.cluster_osds_count
              description: Ceph Cluster OSDs
              unit: osds
              chart_type: line
              dimensions:
                - name: osds
            - name: ceph.cluster_osds_by_status_count
              description: Ceph Cluster OSDs by Status
              unit: status
              chart_type: line
              dimensions:
                - name: up
                - name: down
                - name: in
                - name: out
            - name: ceph.cluster_managers_count
              description: Ceph Cluster Managers
              unit: managers
              chart_type: line
              dimensions:
                - name: active
                - name: standby
            - name: ceph.cluster_object_gateways_count
              description: Ceph Cluster Object Gateways (RGW)
              unit: gateways
              chart_type: line
              dimensions:
                - name: object
            - name: ceph.cluster_iscsi_gateways_count
              description: Ceph Cluster iSCSI Gateways
              unit: gateways
              chart_type: line
              dimensions:
                - name: iscsi
            - name: ceph.cluster_iscsi_gateways_by_status_count
              description: Ceph Cluster iSCSI Gateways by Status
              unit: gateways
              chart_type: line
              dimensions:
                - name: up
                - name: down
            - name: ceph.cluster_physical_capacity_utilization
              description: Ceph Cluster Physical Capacity Utilization
              unit: percent
              chart_type: area
              dimensions:
                - name: utilization
            - name: ceph.cluster_physical_capacity_usage
              description: Ceph Cluster Physical Capacity Usage
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: avail
                - name: used
            - name: ceph.cluster_objects_count
              description: Ceph Cluster Objects
              unit: objects
              chart_type: line
              dimensions:
                - name: objects
            - name: ceph.cluster_objects_by_status_distribution
              description: Ceph Cluster Objects by Status
              unit: percent
              chart_type: stacked
              dimensions:
                - name: healthy
                - name: misplaced
                - name: degraded
                - name: unfound
            - name: ceph.cluster_pools_count
              description: Ceph Cluster Pools
              unit: pools
              chart_type: line
              dimensions:
                - name: pools
            - name: ceph.cluster_pgs_count
              description: Ceph Cluster Placement Groups
              unit: pgs
              chart_type: line
              dimensions:
                - name: pgs
            - name: ceph.cluster_pgs_by_status_count
              description: Ceph Cluster Placement Groups by Status
              unit: pgs
              chart_type: stacked
              dimensions:
                - name: clean
                - name: working
                - name: warning
                - name: unknown
            - name: ceph.cluster_pgs_per_osd_count
              description: Ceph Cluster Placement Groups per OSD
              unit: pgs
              chart_type: line
              dimensions:
                - name: per_osd
        - name: osd
          description: These metrics refer to the Object Storage Daemon (OSD).
          labels:
            - name: fsid
              description: A unique identifier of the cluster.
            - name: osd_uuid
              description: OSD UUID.
            - name: osd_name
              description: OSD name.
            - name: device_class
              description: OSD device class.
          metrics:
            - name: ceph.osd_status
              description: Ceph OSD Status
              unit: status
              chart_type: line
              dimensions:
                - name: up
                - name: down
                - name: in
                - name: out
            - name: ceph.osd_space_usage
              description: Ceph OSD Space Usage
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: avail
                - name: used
            - name: ceph.osd_io
              description: Ceph OSD IO
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: read
                - name: written
            - name: ceph.osd_iops
              description: Ceph OSD IOPS
              unit: ops/s
              chart_type: area
              dimensions:
                - name: read
                - name: write
            - name: ceph.osd_latency
              description: Ceph OSD Latency
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: commit
                - name: apply
        - name: pool
          description: These metrics refer to the Pool.
          labels:
            - name: fsid
              description: A unique identifier of the cluster.
            - name: pool_name
              description: Pool name.
          metrics:
            - name: ceph.pool_space_utilization
              description: Ceph Pool Space Utilization
              unit: percent
              chart_type: area
              dimensions:
                - name: utilization
            - name: ceph.pool_space_usage
              description: Ceph Pool Space Usage
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: avail
                - name: used
            - name: ceph.pool_objects_count
              description: Ceph Pool Objects
              unit: objects
              chart_type: line
              dimensions:
                - name: object
            - name: ceph.pool_io
              description: Ceph Pool IO
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: read
                - name: written
            - name: ceph.pool_iops
              description: Ceph Pool IOPS
              unit: ops/s
              chart_type: area
              dimensions:
                - name: read
                - name: write
