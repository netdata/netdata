plugin_name: go.d.plugin
modules:
  - meta:
      id: collector-go.d.plugin-nats
      plugin_name: go.d.plugin
      module_name: nats
      monitored_instance:
        name: NATS
        link: https://nats.io/
        categories:
          - data-collection.message-brokers
        icon_filename: nats.svg
      related_resources:
        integrations:
          list: []
      alternative_monitored_instances: []
      info_provided_to_referring_integrations:
        description: ""
      keywords:
        - nats
        - messaging
        - broker
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors the activity and performance of NATS servers.
        method_description: |
          It sends HTTP requests to the NATS HTTP server's dedicated [monitoring port](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#monitoring-nats).
      default_behavior:
        auto_detection:
          description: |
            The collector can automatically detect NATS instances running on:

            - localhost that are listening on port 8222
            - within Docker containers
        limits:
          description: ""
        performance_impact:
          description: ""
      additional_permissions:
        description: ""
      multi_instance: true
      supported_platforms:
        include: []
        exclude: []
    setup:
      prerequisites:
        list:
          - title: Enable NATS monitoring
            description: |
              See [Enable monitoring](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#enabling-monitoring).
      configuration:
        file:
          name: go.d/nats.conf
        options:
          description: |
            The following options can be defined globally: update_every, autodetection_retry.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection interval (seconds).
              default_value: 1
              required: false
              group: Base
            - name: autodetection_retry
              description: Autodetection retry interval (seconds). Set 0 to disable.
              default_value: 0
              required: false
              group: Base
            - name: url
              description: Target endpoint URL.
              default_value: http://127.0.0.1:8222
              required: true
              group: Base
            - name: timeout
              description: HTTP request timeout (seconds).
              default_value: 1
              required: false
              group: Base

            - name: healthz_check
              description: "Selects the `/healthz` [endpoint mode](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#health-healthz). Options: `default` (standard check), `js-enabled-only` (error if JetStream is disabled), `js-server-only` (skip account/stream/consumer checks)."
              default_value: default
              required: false
              group: Validation

            - name: username
              description: Username for Basic HTTP authentication.
              default_value: ""
              required: false
              group: HTTP Auth
            - name: password
              description: Password for Basic HTTP authentication.
              default_value: ""
              required: false
              group: HTTP Auth
            - name: bearer_token_file
              description: "Path to a file containing a bearer token (used for `Authorization: Bearer`)."
              default_value: ""
              required: false
              group: HTTP Auth

            - name: tls_skip_verify
              description: Skip TLS certificate and hostname verification (insecure).
              default_value: no
              required: false
              group: TLS
            - name: tls_ca
              description: Path to CA bundle used to validate the server certificate.
              default_value: ""
              required: false
              group: TLS
            - name: tls_cert
              description: Path to client TLS certificate (for mTLS).
              default_value: ""
              required: false
              group: TLS
            - name: tls_key
              description: Path to client TLS private key (for mTLS).
              default_value: ""
              required: false
              group: TLS

            - name: proxy_url
              description: HTTP proxy URL.
              default_value: ""
              required: false
              group: Proxy
            - name: proxy_username
              description: Username for proxy Basic HTTP authentication.
              default_value: ""
              required: false
              group: Proxy
            - name: proxy_password
              description: Password for proxy Basic HTTP authentication.
              default_value: ""
              required: false
              group: Proxy

            - name: method
              description: HTTP method to use.
              default_value: "GET"
              required: false
              group: Request
            - name: body
              description: Request body (e.g., for POST/PUT).
              default_value: ""
              required: false
              group: Request
            - name: headers
              description: "Additional HTTP headers (one per line as key: value)."
              default_value: ""
              required: false
              group: Request
            - name: not_follow_redirects
              description: Do not follow HTTP redirects.
              default_value: no
              required: false
              group: Request
            - name: force_http2
              description: Force HTTP/2 (including h2c over TCP).
              default_value: no
              required: false
              group: Request

            - name: vnode
              description: Associates this data collection job with a [Virtual Node](https://learn.netdata.cloud/docs/netdata-agent/configuration/organize-systems-metrics-and-alerts#virtual-nodes).
              default_value: ""
              required: false
              group: Virtual Node
        examples:
          folding:
            title: Config
            enabled: true
          list:
            - name: Basic
              description: A basic example configuration.
              folding:
                enabled: false
              config: |
                jobs:
                  - name: local
                    url: http://127.0.0.1:8222
            - name: HTTP authentication
              description: Basic HTTP authentication.
              config: |
                jobs:
                  - name: local
                    url: http://127.0.0.1:8222
                    username: username
                    password: password
            - name: HTTPS with self-signed certificate
              description: NATS with enabled HTTPS and self-signed certificate.
              config: |
                jobs:
                  - name: local
                    url: http://127.0.0.1:8222
                    tls_skip_verify: yes
            - name: Multi-instance
              description: |
                > **Note**: When you define multiple jobs, their names must be unique.
                
                Collecting metrics from local and remote instances.
              config: |
                jobs:
                  - name: local
                    url: http://127.0.0.1:8222
                
                  - name: remote
                    url: http://192.0.2.1:8222
    troubleshooting:
      problems:
        list: []
    alerts: []
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: ""
      availability: []
      scopes:
        - name: server
          description: These metrics refer to NATS servers.
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
          metrics:
            - name: nats.server_traffic
              description: Server Traffic
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: received
                - name: sent
            - name: nats.server_messages
              description: Server Messages
              unit: messages/s
              chart_type: line
              dimensions:
                - name: received
                - name: sent
            - name: nats.server_connections
              description: Server Active Connections
              unit: connections
              chart_type: line
              dimensions:
                - name: active
            - name: nats.server_connections_rate
              description: Server Connections
              unit: connections/s
              chart_type: line
              dimensions:
                - name: connections
            - name: nats.server_health_probe_status
              description: Server Health Probe Status
              unit: status
              chart_type: line
              dimensions:
                - name: ok
                - name: error
            - name: nats.server_cpu_usage
              description: Server CPU Usage
              unit: percent
              chart_type: area
              dimensions:
                - name: used
            - name: nats.server_mem_usage
              description: Server Memory Usage
              unit: bytes
              chart_type: area
              dimensions:
                - name: used
            - name: nats.server_uptime
              description: Server Uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
            - name: nats.jetstream_streams
              description: JetStream Streams
              unit: streams
              chart_type: line
              dimensions:
                - name: active
            - name: nats.jetstream_streams_storage_bytes
              description: JetStream Bytes
              unit: bytes
              chart_type: area
              dimensions:
                - name: used
            - name: nats.jetstream_streams_storage_messages
              description: JetStream Messages
              unit: messaged
              chart_type: line
              dimensions:
                - name: stored
            - name: nats.jetstream_consumers
              description: JetStream Consumers
              unit: consumers
              chart_type: line
              dimensions:
                - name: active
            - name: nats.jetstream_api_requests
              description: JetStream API Requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: requests
            - name: nats.jetstream_api_errors
              description: JetStream API Errors
              unit: errors/s
              chart_type: line
              dimensions:
                - name: errors
            - name: nats.jetstream_api_inflight
              description: JetStream API Inflight
              unit: requests
              chart_type: line
              dimensions:
                - name: inflight
            - name: nats.jetstream_memory_used
              description: JetStream Used Memory
              unit: bytes
              chart_type: area
              dimensions:
                - name: used
            - name: nats.jetstream_storage_used
              description: JetStream Used Storage
              unit: bytes
              chart_type: line
              dimensions:
                - name: used
        - name: http endpoint
          description: These metrics refer to HTTP endpoints.
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
            - name: http_endpoint
              description: "HTTP endpoint path."
          metrics:
            - name: nats.http_endpoint_requests
              description: HTTP Endpoint Requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: requests
        - name: account
          description: These metrics refer to [Accounts](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#account-statistics).
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
            - name: account
              description: "Account name."
          metrics:
            - name: nats.account_traffic
              description: Account Traffic
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: received
                - name: sent
            - name: nats.account_messages
              description: Account Messages
              unit: messages/s
              chart_type: line
              dimensions:
                - name: received
                - name: sent
            - name: nats.account_connections
              description: Account Active Connections
              unit: connections
              chart_type: line
              dimensions:
                - name: active
            - name: nats.account_connections_rate
              description: Account Connections
              unit: connections/s
              chart_type: line
              dimensions:
                - name: connections
            - name: nats.account_subscriptions
              description: Account Active Subscriptions
              unit: subscriptions
              chart_type: line
              dimensions:
                - name: active
            - name: nats.account_slow_consumers
              description: Account Slow Consumers
              unit: consumers/s
              chart_type: line
              dimensions:
                - name: slow
            - name: nats.account_leaf_nodes
              description: Account Leaf Nodes
              unit: servers
              chart_type: line
              dimensions:
                - name: leafnode
        - name: route
          description: These metrics refer to [Routes](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#route-information).
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
            - name: route_id
              description: "A unique identifier for a route within the NATS cluster."
            - name: remote_id
              description: "he unique identifier of the remote server connected via the route."
          metrics:
            - name: nats.route_traffic
              description: Route Traffic
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: in
                - name: out
            - name: nats.route_messages
              description: Route Messages
              unit: messages/s
              chart_type: line
              dimensions:
                - name: in
                - name: out
            - name: nats.route_subscriptions
              description: Route Active Subscriptions
              unit: subscriptions
              chart_type: line
              dimensions:
                - name: active
        - name: inbound gateway connection
          description: These metrics refer to [Inbound Gateway Connections](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#gateway-information).
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
            - name: gateway
              description: "The name of the local gateway."
            - name: remote_gateway
              description: "The name of the remote gateway."
            - name: cid
              description: "A unique identifier for the connection."
          metrics:
            - name: nats.inbound_gateway_conn_traffic
              description: Inbound Gateway Traffic
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: in
                - name: out
            - name: nats.inbound_gateway_conn_messages
              description: Inbound Gateway Messages
              unit: messages/s
              chart_type: line
              dimensions:
                - name: in
                - name: out
            - name: nats.inbound_gateway_conn_subscriptions
              description: Inbound Gateway Active Subscriptions
              unit: subscriptions
              chart_type: line
              dimensions:
                - name: active
            - name: nats.inbound_gateway_conn_uptime
              description: Inbound Gateway Connection Uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
        - name: outbound gateway connection
          description: These metrics refer to [Outbound Gateway Connections](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#gateway-information).
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
            - name: gateway
              description: "The name of the local gateway."
            - name: remote_gateway
              description: "The name of the remote gateway."
            - name: cid
              description: "A unique identifier for the connection."
          metrics:
            - name: nats.outbound_gateway_conn_traffic
              description: Outbound Gateway Traffic
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: in
                - name: out
            - name: nats.outbound_gateway_conn_messages
              description: Outbound Gateway Messages
              unit: messages/s
              chart_type: line
              dimensions:
                - name: in
                - name: out
            - name: nats.outbound_gateway_conn_subscriptions
              description: Outbound Gateway Active Subscriptions
              unit: subscriptions
              chart_type: line
              dimensions:
                - name: active
            - name: nats.outbound_gateway_conn_uptime
              description: Outbound Gateway Connection Uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
        - name: leaf node connection
          description: These metrics refer to [Leaf Node Connections](https://docs.nats.io/running-a-nats-service/nats_admin/monitoring#leaf-node-information).
          labels:
            - name: cluster_name
              description: "The name of the NATS cluster this server belongs to."
            - name: server_id
              description: "A unique identifier for a server within the NATS cluster."
            - name: server_name
              description: "The configured name of the NATS server."
            - name: remote_name
              description: "Unique identifier of the remote leaf node server, either its configured name or automatically assigned ID."
            - name: account
              description: "Name of the associated account."
            - name: ip
              description: "IP address of the remote server."
            - name: port
              description: "Port used for the connection to the remote server."
          metrics:
            - name: nats.leaf_node_conn_traffic
              description: Leaf Node Connection Traffic
              unit: bytes/s
              chart_type: area
              dimensions:
                - name: in
                - name: out
            - name: nats.leaf_node_conn_messages
              description: Leaf Node Connection Messages
              unit: messages/s
              chart_type: line
              dimensions:
                - name: in
                - name: out
            - name: nats.leaf_node_conn_subscriptions
              description: Leaf Node Connection Active Subscriptions
              unit: subscriptions
              chart_type: line
              dimensions:
                - name: active
            - name: nats.leaf_node_conn_rtt
              description: Leaf Node Connection RTT
              unit: microseconds
              chart_type: line
              dimensions:
                - name: rtt
