plugin_name: go.d.plugin
modules:
  - meta:
      id: collector-go.d.plugin-proxysql
      plugin_name: go.d.plugin
      module_name: proxysql
      monitored_instance:
        name: ProxySQL
        link: https://www.proxysql.com/
        icon_filename: proxysql.png
        categories:
          - data-collection.databases
      keywords:
        - proxysql
        - databases
        - sql
      related_resources:
        integrations:
          list: []
      info_provided_to_referring_integrations:
        description: ""
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors ProxySQL servers.
        method_description: ""
      supported_platforms:
        include: []
        exclude: []
      multi_instance: true
      additional_permissions:
        description: ""
      default_behavior:
        auto_detection:
          description: ""
        limits:
          description: ""
        performance_impact:
          description: ""
    setup:
      prerequisites:
        list: []
      configuration:
        file:
          name: go.d/proxysql.conf
        options:
          description: |
            The following options can be defined globally: update_every, autodetection_retry.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection frequency (seconds).
              default_value: 1
              required: false
              group: Collection
            - name: autodetection_retry
              description: Autodetection retry interval (seconds). Set 0 to disable.
              default_value: 0
              required: false
              group: Collection

            - name: dsn
              description: ProxySQL server DSN (Data Source Name). See [DSN syntax](https://github.com/go-sql-driver/mysql#dsn-data-source-name).
              default_value: stats:stats@tcp(127.0.0.1:6032)/
              required: true
              group: Target
            - name: timeout
              description: Query timeout (seconds).
              default_value: 1
              required: false
              group: Target

            - name: functions.top_queries.disabled
              description: Disable the [top-queries](#top-queries) function.
              default_value: false
              required: false
              group: Functions
            - name: functions.top_queries.timeout
              description: Query timeout (seconds). Uses collector timeout if not set.
              default_value: ""
              required: false
              group: Functions
            - name: functions.top_queries.limit
              description: Maximum number of queries to return.
              default_value: 500
              required: false
              group: Functions

            - name: vnode
              description: Associates this data collection job with a [Virtual Node](https://learn.netdata.cloud/docs/netdata-agent/configuration/organize-systems-metrics-and-alerts#virtual-nodes).
              default_value: ""
              required: false
              group: Virtual Node
        examples:
          folding:
            title: Config
            enabled: true
          list:
            - name: TCP socket
              description: An example configuration.
              config: |
                jobs:
                  - name: local
                    dsn: stats:stats@tcp(127.0.0.1:6032)/
            - name: my.cnf
              description: An example configuration.
              config: |
                jobs:
                  - name: local
                    my.cnf: '/etc/my.cnf'
            - name: Multi-instance
              description: |
                > **Note**: When you define multiple jobs, their names must be unique.

                Local and remote instances.
              config: |
                jobs:
                  - name: local
                    dsn: stats:stats@tcp(127.0.0.1:6032)/
                
                  - name: remote
                    dsn: stats:stats@tcp(203.0.113.0:6032)/
    troubleshooting:
      problems:
        list: []
    alerts:
      - name: proxysql_hostgroup_no_online_backends
        metric: proxysql.hostgroup_backends_status
        info: ProxySQL hostgroup ${label:hostgroup} has no ONLINE backends
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/proxysql.conf
      - name: proxysql_backend_shunned
        metric: proxysql.backend_status
        info: ProxySQL backend SHUNNED (${label:host}:${label:port} hostgroup ${label:hostgroup})
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/proxysql.conf
      - name: proxysql_backend_offline_hard
        metric: proxysql.backend_status
        info: ProxySQL backend OFFLINE_HARD (${label:host}:${label:port} hostgroup ${label:hostgroup})
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/proxysql.conf
    functions:
      description: |
        This collector exposes real-time functions for interactive troubleshooting in the Top tab.
      list:
        - id: top-queries
          name: Top Queries
          description: |
            Retrieves aggregated query statistics from ProxySQL's [stats_mysql_query_digest](https://proxysql.com/documentation/stats-statistics/#stats_mysql_query_digest) table.

            This function queries the `stats_mysql_query_digest` table which stores runtime statistics for all queries proxied through ProxySQL, aggregated by query digest (normalized query pattern). It provides timing metrics, execution counts, and error statistics for each unique query pattern.

            Use cases:
            - Identify slow queries consuming excessive total execution time
            - Find high-frequency queries that may benefit from caching
            - Monitor query error rates across backends

            Query text is truncated at 4096 characters for display purposes.
          parameters:
            - id: __sort
              name: Filter By
              description: Select the primary sort column. Options include total execution time, number of calls, rows affected, rows sent, errors, and warnings. Defaults to total time to focus on most resource-intensive queries.
              type: select
              required: true
              default: totalTime
              options: []
          returns:
            description: Aggregated query digest statistics from ProxySQL, providing comprehensive performance analysis across all monitored MySQL backends. Each row represents a unique query pattern (normalized digest) with cumulative metrics across all its executions.
            columns:
              - name: Digest
                type: string
                unit: ""
                visibility: hidden
                description: Unique hash identifier for normalized query pattern. Queries with identical structure but different literal values share the same digest.
              - name: Query
                type: string
                unit: ""
                description: The SQL query text with literal values truncated at 4096 characters. Use this to identify the actual SQL being executed and spot parameterized queries or injection risks.
              - name: Schema
                type: string
                unit: ""
                description: Database name where the query was executed. Essential for multi-database analysis to identify which database or backend is experiencing query load.
              - name: User
                type: string
                unit: ""
                visibility: hidden
                description: MySQL username used to execute the query. Useful for identifying application users or connection pool attribution.
              - name: Hostgroup
                type: integer
                unit: ""
                visibility: hidden
                description: Backend hostgroup identifier from ProxySQL configuration. Allows grouping queries by backend server for multi-backend analysis.
              - name: Calls
                type: integer
                unit: ""
                description: Total number of times this query pattern has been executed. High values indicate frequently run queries that may impact server performance significantly.
              - name: Total Time
                type: duration
                unit: "milliseconds"
                description: Cumulative execution time across all query executions. This is a key metric for identifying the most resource-intensive queries in terms of total server time consumption.
              - name: Avg Time
                type: duration
                unit: "milliseconds"
                description: Average execution time per query run. Compare with Total Time to determine if individual executions or high frequency drives resource usage.
              - name: Min Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: Minimum execution time observed. Helps identify variability in query performance and spot potential optimization opportunities for outliers.
              - name: Max Time
                type: duration
                unit: "milliseconds"
                visibility: hidden
                description: Maximum execution time observed. Large gaps between Min Time and Max Time may indicate performance instability due to parameter sniffing, data skew, or lock contention.
              - name: Rows Affected
                type: integer
                unit: ""
                description: Total number of rows modified by INSERT, UPDATE, DELETE, or REPLACE statements. Useful for tracking write workloads and data modification patterns.
              - name: Rows Sent
                type: integer
                unit: ""
                description: Total number of rows returned to the client by SELECT statements. High values may indicate queries returning large result sets that consume significant network bandwidth and client resources.
              - name: Errors
                type: integer
                unit: ""
                description: Total number of times this query pattern resulted in an error. Non-zero values require investigation into the underlying SQL syntax, permission issues, or constraint violations.
              - name: Warnings
                type: integer
                unit: ""
                description: Total number of times this query pattern generated a warning. Warnings may indicate data type conversions, NULL handling issues, or other non-critical SQL problems that should be reviewed.
              - name: First Seen
                type: string
                unit: ""
                visibility: hidden
                description: Timestamp when this query pattern was first observed. Helps identify new queries that may have been introduced by application changes or code deployments.
              - name: Last Seen
                type: string
                unit: ""
                visibility: hidden
                description: Timestamp when this query pattern was last executed. Can help identify stale queries that are no longer in use or to track recent query activity.
          performance: |
            Queries ProxySQL admin interface for digest statistics:<br/>• Reads from in-memory `stats_mysql_query_digest` table<br/>• Default limit of 500 rows balances completeness with performance<br/>• Data is aggregated in-memory by ProxySQL from active connections
          security: |
            Query text may contain unmasked literal values including potentially sensitive data:<br/>• Personal information in WHERE clauses or INSERT values<br/>• Business data embedded in queries<br/>• Access should be restricted to authorized personnel only
          availability: |
            Available when:<br/>• The collector has successfully connected to ProxySQL admin interface<br/>• Returns HTTP 503 if the connection cannot be established<br/>• Returns HTTP 500 if the query fails<br/>• Returns HTTP 504 if the query times out
          require_cloud: true
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: ""
      availability: []
      scopes:
        - name: global
          description: These metrics refer to the entire monitored application.
          labels: []
          metrics:
            - name: proxysql.client_connections_count
              description: Client connections
              unit: connections
              chart_type: line
              dimensions:
                - name: connected
                - name: non_idle
                - name: hostgroup_locked
            - name: proxysql.client_connections_rate
              description: Client connections rate
              unit: connections/s
              chart_type: line
              dimensions:
                - name: created
                - name: aborted
            - name: proxysql.server_connections_count
              description: Server connections
              unit: connections
              chart_type: line
              dimensions:
                - name: connected
            - name: proxysql.server_connections_rate
              description: Server connections rate
              unit: connections/s
              chart_type: line
              dimensions:
                - name: created
                - name: aborted
                - name: delayed
            - name: proxysql.backends_traffic
              description: Backends traffic
              unit: B/s
              chart_type: line
              dimensions:
                - name: recv
                - name: sent
            - name: proxysql.clients_traffic
              description: Clients traffic
              unit: B/s
              chart_type: line
              dimensions:
                - name: recv
                - name: sent
            - name: proxysql.active_transactions_count
              description: Client connections that are currently processing a transaction
              unit: connections
              chart_type: line
              dimensions:
                - name: client
            - name: proxysql.questions_rate
              description: Client requests / statements executed
              unit: questions/s
              chart_type: line
              dimensions:
                - name: questions
            - name: proxysql.slow_queries_rate
              description: Slow queries
              unit: queries/s
              chart_type: line
              dimensions:
                - name: slow
            - name: proxysql.queries_rate
              description: Queries rate
              unit: queries/s
              chart_type: stacked
              dimensions:
                - name: autocommit
                - name: autocommit_filtered
                - name: commit_filtered
                - name: rollback
                - name: rollback_filtered
                - name: backend_change_user
                - name: backend_init_db
                - name: backend_set_names
                - name: frontend_init_db
                - name: frontend_set_names
                - name: frontend_use_db
            - name: proxysql.backend_statements_count
              description: Statements available across all backend connections
              unit: statements
              chart_type: line
              dimensions:
                - name: total
                - name: unique
            - name: proxysql.backend_statements_rate
              description: Statements executed against the backends
              unit: statements/s
              chart_type: stacked
              dimensions:
                - name: prepare
                - name: execute
                - name: close
            - name: proxysql.client_statements_count
              description: Statements that are in use by clients
              unit: statements
              chart_type: line
              dimensions:
                - name: total
                - name: unique
            - name: proxysql.client_statements_rate
              description: Statements executed by clients
              unit: statements/s
              chart_type: stacked
              dimensions:
                - name: prepare
                - name: execute
                - name: close
            - name: proxysql.cached_statements_count
              description: Global prepared statements
              unit: statements
              chart_type: line
              dimensions:
                - name: cached
            - name: proxysql.query_cache_entries_count
              description: Query Cache entries
              unit: entries
              chart_type: line
              dimensions:
                - name: entries
            - name: proxysql.query_cache_memory_used
              description: Query Cache memory used
              unit: B
              chart_type: line
              dimensions:
                - name: used
            - name: proxysql.query_cache_io
              description: Query Cache I/O
              unit: B/s
              chart_type: line
              dimensions:
                - name: in
                - name: out
            - name: proxysql.query_cache_requests_rate
              description: Query Cache requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: read
                - name: write
                - name: read_success
            - name: proxysql.mysql_monitor_workers_count
              description: MySQL monitor workers
              unit: threads
              chart_type: line
              dimensions:
                - name: workers
                - name: auxiliary
            - name: proxysql.mysql_monitor_workers_rate
              description: MySQL monitor workers rate
              unit: workers/s
              chart_type: line
              dimensions:
                - name: started
            - name: proxysql.mysql_monitor_connect_checks_rate
              description: MySQL monitor connect checks
              unit: checks/s
              chart_type: line
              dimensions:
                - name: succeed
                - name: failed
            - name: proxysql.mysql_monitor_ping_checks_rate
              description: MySQL monitor ping checks
              unit: checks/s
              chart_type: line
              dimensions:
                - name: succeed
                - name: failed
            - name: proxysql.mysql_monitor_read_only_checks_rate
              description: MySQL monitor read only checks
              unit: checks/s
              chart_type: line
              dimensions:
                - name: succeed
                - name: failed
            - name: proxysql.mysql_monitor_replication_lag_checks_rate
              description: MySQL monitor replication lag checks
              unit: checks/s
              chart_type: line
              dimensions:
                - name: succeed
                - name: failed
            - name: proxysql.jemalloc_memory_used
              description: Jemalloc used memory
              unit: B
              chart_type: stacked
              dimensions:
                - name: active
                - name: allocated
                - name: mapped
                - name: metadata
                - name: resident
                - name: retained
            - name: proxysql.memory_used
              description: Memory used
              unit: B
              chart_type: stacked
              dimensions:
                - name: auth
                - name: sqlite3
                - name: query_digest
                - name: query_rules
                - name: firewall_users_table
                - name: firewall_users_config
                - name: firewall_rules_table
                - name: firewall_rules_config
                - name: mysql_threads
                - name: admin_threads
                - name: cluster_threads
            - name: proxysql.uptime
              description: Uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
        - name: command
          description: These metrics refer to the SQL command.
          labels:
            - name: command
              description: SQL command.
          metrics:
            - name: proxysql.mysql_command_execution_rate
              description: MySQL command execution
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
            - name: proxysql.mysql_command_execution_time
              description: MySQL command execution time
              unit: microseconds
              chart_type: line
              dimensions:
                - name: time
            - name: proxysql.mysql_command_execution_duration
              description: MySQL command execution duration histogram
              unit: microseconds
              chart_type: stacked
              dimensions:
                - name: 100us
                - name: 500us
                - name: 1ms
                - name: 5ms
                - name: 10ms
                - name: 50ms
                - name: 100ms
                - name: 500ms
                - name: 1s
                - name: 5s
                - name: 10s
                - name: +Inf
        - name: user
          description: These metrics refer to the user.
          labels:
            - name: user
              description: username from the mysql_users table
          metrics:
            - name: proxysql.mysql_user_connections_utilization
              description: MySQL user connections utilization
              unit: percentage
              chart_type: line
              dimensions:
                - name: used
            - name: proxysql.mysql_user_connections_count
              description: MySQL user connections used
              unit: connections
              chart_type: line
              dimensions:
                - name: used
        - name: hostgroup
          description: These metrics refer to the backends hostgroup.
          labels:
            - name: hostgroup
              description: hostgroup identifier
          metrics:
            - name: proxysql.hostgroup_backends_status
              description: Hostgroup backends count in each status
              unit: backends
              chart_type: line
              dimensions:
                - name: online
                - name: shunned
                - name: offline_soft
                - name: offline_hard
        - name: backend
          description: These metrics refer to the backend server.
          labels:
            - name: hostgroup
              description: backend server hostgroup
            - name: host
              description: backend server host
            - name: port
              description: backend server port
          metrics:
            - name: proxysql.backend_status
              description: Backend status
              unit: status
              chart_type: line
              dimensions:
                - name: online
                - name: shunned
                - name: offline_soft
                - name: offline_hard
            - name: proxysql.backend_connections_usage
              description: Backend connections usage
              unit: connections
              chart_type: line
              dimensions:
                - name: free
                - name: used
            - name: proxysql.backend_connections_rate
              description: Backend connections established
              unit: connections/s
              chart_type: line
              dimensions:
                - name: succeed
                - name: failed
            - name: proxysql.backend_queries_rate
              description: Backend queries
              unit: queries/s
              chart_type: line
              dimensions:
                - name: queries
            - name: proxysql.backend_traffic
              description: Backend traffic
              unit: B/s
              chart_type: line
              dimensions:
                - name: recv
                - name: send
            - name: proxysql.backend_latency
              description: Backend latency
              unit: microseconds
              chart_type: line
              dimensions:
                - name: latency
